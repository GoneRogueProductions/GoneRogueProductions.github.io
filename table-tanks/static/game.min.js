(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.setup_layout=function(){var t;return $("#inner_column").max_height($(".header_widget").outerHeight(!0)||0),$(window).on("message",function(t){var e,r;if(r=RegExp("\\/\\/"+$(document.body).data("host")+"\\/"),t.originalEvent.origin.match&&"dimensions"===(e=t.originalEvent.data).name)return parent.postMessage({width:$(document).width(),height:$(document).height()},"*")}),new I.ViewGameFooter("#view_game_footer")},I.EmbedGameLightbox=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return t(r,e),r}(I.Lightbox),I.ViewGameFooter=function t(e){var r,o;this.el=$(e),this.el.dispatch("click",{embed_game_btn:function(t){return I.Lightbox.open_remote(t.data("lightbox_url"),I.EmbedGameLightbox)},report_game_btn:function(t){return I.Lightbox.open_remote_react(t.data("lightbox_url"),function(t){return R.Game.ReportLightbox(t)})}})},I.GameUserTools=function t(e){var r,o,i;this.el=$(e),I.tracked_links(this.el,"view_game","user_tools"),I.has_follow_button(this.el,{cls:"follow_user_btn",animate_follow:I.is_mobile()?"animate_popout":void 0}),this.el.dispatch("click",{add_to_collection_btn:function(t){return I.current_user?I.Lightbox.open_remote(t.attr("href"),I.CollectionLightbox):"continue"},rate_game_btn:(o=this,function(t){return I.current_user?I.Lightbox.open_remote_react(t.attr("href"),function(t){return t.on_save_rating=function(t){return o.el.find(".rate_game_btn").addClass("has_rating")},t.on_delete_rating=function(t){return o.el.find(".rate_game_btn").removeClass("has_rating")},R.Library.RateGameLightbox(t)}):"continue"})}),setTimeout((i=this,function(){return i.el.removeClass("hidden")}),200)},I.FirstGameLightbox=function(e){function r(){var t,e;return this.first_show=(t=this.first_show,e=this,function(){return t.apply(e,arguments)}),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.first_show=function(){var t;return I.event("view_game","first_game_lb","show"),I.add_facebook(function(){var t;return t="view_game",FB.Event.subscribe("edge.create",function(e){return I.event(t,"fb","like")}),FB.Event.subscribe("edge.remove",function(e){return I.event(t,"fb","unlike")}),FB.Event.subscribe("message.send",function(e){return I.event(t,"fb","share")})}),I.add_twitter()},r}(I.Lightbox),I.GameGoalBanner=function t(e){var r;this.el=$(e),this.el.dispatch("click",{buy_btn:function(t){return(I.event("view_game","goal_banner","contribute_btn"),I.is_mobile())?(t.attr("href",I.add_params(t.attr("href"),{initiator:"mobile"})),"continue"):$(".buy_row a.buy_btn").click()}})}}).call(this),(function(){I.GameDevlogPost=function(){function t(t,e){var r,o,i;this.render_like_button=(r=this.render_like_button,o=this,function(){return r.apply(o,arguments)}),this.el=$(t),this.image_viewer=new I.ImageViewer(t),this.el.dispatch("click",{add_to_collection_btn:function(t){return I.current_user?I.Lightbox.open_remote(t.attr("href"),I.CollectionLightbox):"continue"}}),this.render_like_button()}return t.prototype.vote_counts_template=I.lazy_template(t,"like_button"),t.prototype.render_like_button=function(t){var e,r,o;return r=this.el.find(".like_button_drop"),this.like_button_state||(this.like_button_state=r.data("init")),t&&$.extend(this.like_button_state,t),(e=r.html(this.vote_counts_template(this.like_button_state)).children()).find("form").remote_submit((o=this,function(t){return o.render_like_button({liked:!o.like_button_state.liked,likes_count:t.likes_count})}))},t}()}).call(this),(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.GameHeader=function(e){function r(){var t,e;r.__super__.constructor.apply(this,arguments),this.el.dispatch("click",{edit_theme_btn:(t=this,function(){return t.toggle_theme_editor()})}),window.location.hash.match(/\bedit_theme\b/)&&_.defer((e=this,function(){return e.toggle_theme_editor()}))}return t(r,e),r.prototype.toggle_theme_editor=function(){var t;return t=!I.theme_editor.state.open,I.theme_editor.setState({open:t}),$(document.body).toggleClass("theme_editor_open",t)},r}(I.Header)}).call(this),(function(){I.HtmlEmbed=function(){function t(t,e){var r,o,i,s,n,a;this.opts=e,this.load_frame=(r=this.load_frame,o=this,function(){return r.apply(o,arguments)}),this.el=$(t),"resolved"===I.HtmlEmbed.current.state()?I.HtmlEmbed.current=$.Deferred().resolve(this):I.HtmlEmbed.current.resolve(this),this.load_archive(),window.history.state&&this.synchronize_state(window.history.state),this.opts.width&&I.ViewGame.current.then((i=this,function(t){return t.fit_to_width(i.opts.width)})),this.el.dispatch("click",{load_iframe_btn:(s=this,function(t){return s.load_frame().done(function(t){return(setTimeout(function(){var e;return null!=(e=t[0])?e.focus():void 0},100),I.is_mobile())?s.enter_fullscreen():s.opts.start_maximized?s.enter_maximized():void 0})}),fullscreen_btn:(n=this,function(t){return n.enter_fullscreen()}),restore_btn:(a=this,function(t){return(a.load_frame().done(function(t){return setTimeout(function(){var e;return null!=(e=t[0])?e.focus():void 0},100)}),I.is_mobile())?a.enter_fullscreen():a.enter_maximized()})})}return t.current=$.Deferred().done(function(){return window.addEventListener("popstate",function(t){var e;return e=t.state||{},I.HtmlEmbed.current.done(function(t){return t.synchronize_state(e)})})}),t.prototype.ping_time=1e3,t.prototype.synchronize_state=function(t){var e;return t.maximized?(this.enter_maximized(!1),setTimeout((e=this,function(){var t;return null!=(t=e.el.find(".game_frame iframe")[0])?t.focus():void 0}),100)):this.exit_maximized()},t.prototype.load_archive=function(){var t;if(this.opts.load_url)return $.get(this.opts.load_url,(t=this,function(e){if(e.html){t.el.replaceWith(e.html);return}if(e.errors){t.el.replaceWith($('<div class="missing_game"></div>').text(e.errors.join(", ")));return}switch(e.status){case"complete":return t.el.closest(".view_game_page").addClass("ready");case"extracting":return setTimeout(function(){return t.ping_time+=100,t.load_archive()},t.ping_time)}}))},t.prototype.mobile_orientation=function(){var t;return this.opts.orientation?this.opts.orientation:this.opts.width&&this.opts.height?(t=this.opts.width/this.opts.height)>=1.4?"landscape":t<=1.7?"portrait":void 0:"landscape"},t.prototype.load_frame=function(){var t;return this._loaded_frame||(this._loaded_frame=$.Deferred((t=this,function(e){var r;return(r=t.el.find(".iframe_placeholder")).replaceWith(r.data("iframe")),t.iframe=t.el.find("#game_drop"),t.el.find(".game_frame").addClass("game_loaded").removeClass("game_pending"),e.resolve(t.iframe)})))},t.prototype.enter_maximized=function(t){var e;if(null==t&&(t=!0),!this.maximized)return this.maximized=!0,this.load_frame().done((e=this,function(){return window.history&&t&&window.history.pushState({maximized:!0},document.title),e.el.find(".game_frame").addClass("maximized"),$(document.body).addClass("frame_maximized")}))},t.prototype.exit_maximized=function(){if(this.maximized)return this.maximized=!1,this.el.find(".game_frame").removeClass("maximized"),$(document.body).removeClass("frame_maximized")},t.prototype.enter_fullscreen=function(){var t,e;if((t=this.el.find(".game_frame iframe"))[0]){if(e=this.mobile_orientation(),!I.is_fullscreen()&&!I.request_fullscreen(t[0],e))return this.enter_maximized()}},t}()}).call(this),(function(){I.ImageViewer=function(){function t(t){var e,r,o;this.size_image=(e=this.size_image,r=this,function(){return e.apply(r,arguments)}),this.el=$(t),this.el.on("click","[data-image_lightbox]",(o=this,function(t){var e,r,i,s,n,a,l,u;if(!I.is_mobile()&&Image)return e=(u=$(t.currentTarget)).parent().find("[data-image_lightbox]"),I.event("view_game","screenshots","show"),(a=I.Lightbox.open(o._template())).el.toggleClass("no_tools",e.length<2),r=null,l=function(t){var e,i,s,n,l,u,p;return r=t,p=(e=$(window)).width()-(o.margin+20)*2,u=e.height()-2*o.margin,i=(l=t.naturalWidth)/(s=t.naturalHeight),l>p&&(l=p,s=p/i),s>u&&(l=u*i,s=u),(n=a.el.find(".lb_screenshot")).attr("src",t.src),l!==t.naturalWidth||s!==t.naturalHeight?n.attr("width",Math.floor(l)).attr("height",Math.floor(s)):n.attr("width",t.naturalWidth).attr("height",t.naturalHeight),a.position(),n.removeClass("hidden"),a.el.removeClass("loading")},i=function(t){var e,r;return a.el.addClass("loading"),u=t,(e=new Image).onload=function(){return l(e)},e.src=$(t).attr("href")},n=function(){var t;return(t=u.prev("[data-image_lightbox]")).length||(t=$(e[e.length-1])),i(t)},s=function(){var t;return(t=u.next("[data-image_lightbox]")).length||(t=$(e[0])),i(t)},a.el.dispatch("click",{lb_screenshot:function(t){return e.length<2?I.Lightbox.close():(I.event("view_game","screenshots","click_screenshot"),s())},prev_image_btn:function(t){return I.event("view_game","screenshots","prev_image_btn"),n()},next_image_btn:function(t){return I.event("view_game","screenshots","next_image_btn"),s()}}),a.el.on("i:lightbox_keydown",function(t,e){switch(e.keyCode){case 37:return I.event("view_game","screenshots","keyboard_left"),n();case 39:return I.event("view_game","screenshots","keyboard_right"),s();case 32:return I.event("view_game","screenshots","Keyboard_space"),s()}}),a.el.on("i:lightbox_resize",function(){if(r)return l(r)}),i(u),!1}))}return t.prototype.margin=40,t.prototype._template=function(){return'<div class="screenshot_lightbox lightbox loading">\n  <div class="screenshot_container">\n    <div class="loader"></div>\n\n    <div class="prev_image_btn">\n      <span class="icon-arrow-left"></span>\n    </div>\n\n    <img class="lb_screenshot hidden" width="400" height="315">\n\n    <div class="next_image_btn">\n      <span class="icon-arrow-right"></span>\n    </div>\n  </div>\n</div>'},t.prototype.size_image=function(){},t}()}).call(this),(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){for(var o in e)r.call(e,o)&&(t[o]=e[o]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},r={}.hasOwnProperty;I.ViewGame=function(){function e(e,r,o){var i,s,n,a,l,u,p,c,d;this.game=r,this.opts=o,this.setup_hiding=t(this.setup_hiding,this),this.setup_buy_on_top=t(this.setup_buy_on_top,this),this.register_play=t(this.register_play,this),this.download_upload=t(this.download_upload,this),I.event2("view game",{type:this.game.type_name,paid:this.game.actual_price>0}),I.ViewGame.current.resolve(this),I.tracked_links($(".jam_banner"),"view_game","jam_banner"),i=$(".devlog_banner").find("form").remote_submit(function(t){return i.end().slideUp("fast")},null,[{name:"json",value:"1"}]),this.el=$(e),this.setup_uploads(),this.setup_buy_on_top(),I.tracked_links(this.el,"view_game","main_column"),this.game.hit_url&&$.get(this.game.hit_url),this.game.play_url&&this.register_play(),this.el.on("click mouseup",".launch_btn[data-rp]",function(t){var e,r;if((r=(e=$(t.currentTarget)).data("rp"))&&(e.data("rp",null),!("undefined"!=typeof navigator&&null!==navigator&&"function"==typeof navigator.sendBeacon?navigator.sendBeacon(r):void 0)))return $.get(r)}),this.el.dispatch("click",{add_to_collection_btn:function(t){return I.is_mobile()||!I.current_user?"continue":I.Lightbox.open_remote(t.attr("href"),I.CollectionLightbox)},toggle_info_btn:(l=this,function(t){return t.closest(".more_information_toggle").toggleClass("open"),l.el.find(".info_panel_wrapper").slideToggle()}),download_btn:(u=this,function(t){var e;return e={},t.closest(".for_demo").length||(e.after_download_lightbox=!0),u.download_upload(t.data("upload_id"),e)}),buy_btn:(p=this,function(t){return(I.event("view_game","buy",""+p.game.id),I.is_mobile())?(t.attr("href",I.add_params(t.attr("href"),{initiator:"mobile"})),"continue"):I.Lightbox.open_remote(t.attr("href"),I.BuyGameLightbox,p.game,{is_donate:!1})}),reward_btn:(c=this,function(t){var e,r,o;return I.event("view_game","buy_reward",""+c.game.id),o=t.attr("href"),(e=(r=t.closest(".reward_footer")).find(".quantity_input"))&&(o=I.add_params(o,{quantity:e.val()})),I.Lightbox.open_remote(o,I.BuyGameLightbox,c.game,{is_donate:!1})}),donate_btn:(d=this,function(t){return(I.event("view_game","donate",""+d.game.id),I.is_mobile())?(t.attr("href",I.add_params(t.attr("href"),{initiator:"mobile"})),"continue"):I.Lightbox.open_remote(t.attr("href"),I.BuyGameLightbox,d.game,{is_donate:t.data("donate")})})}),this.image_viewer=new I.ImageViewer(e),this.setup_referrer(),this.opts.first_view&&I.Lightbox.open_tpl("first_game_lightbox",I.FirstGameLightbox)}return e.current=$.Deferred(),e.prototype.download_upload=function(t,e){var r,o;return r=$.extend({source:"view_game",as_props:"1"},e),I.bypass_quarantine&&(r.bypass_quarantine=!0),I.prepare_download(this.game.slug,t,null,(o=this,function(r,i){if(i.lightbox&&("QuarantineLightbox"===i.lightbox_type?I.Lightbox.open(R.Game.QuarantineLightbox($.extend({on_force_download:function(){return o.download_upload(t,$.extend({},e,{bypass_quarantine:!0}))}},i.lightbox))):I.Lightbox.open(R.AfterDownloadLightbox(i.lightbox))),I.start_download(i))return I.event("view_game","download",""+o.game.id),I.ConversionTracker.download("1:"+o.game.id),I.ConversionTracker.flush_now()}),r)},e.prototype.register_play=function(){var t;return window.setTimeout((t=this,function(){return $.get(t.game.play_url)}),(this.game.play_after+3)*1e3)},e.prototype.setup_buy_on_top=function(){var t;if((t=this.el.find(".formatted_description").outerHeight(!0))<$(window).height()-100)return this.el.removeClass("buy_on_top")},e.prototype.setup_uploads=function(){var t,e,r,o,i,s;for(e=0,this.uploads=this.el.find(".uploads"),o=this.uploads.find(".upload"),i=[],r=o.length;e<r;e++)s=$(t=o[e]).find(".file_size_value"),i.push(s.html(I.format_bytes(parseInt(s.html()))));return i},e.prototype.setup_hiding=function(t){var e,r;return $(document.body).on("i:lightbox_open",function(){return $(t).css({visibility:"hidden"})}),$(document.body).on("i:lightbox_close",function(){return $(t).css({visibility:"visible"})})},e.prototype.fit_to_width=function(t){return t>920?this.opts.responsive||I.is_mobile()?$("#inner_column").css({width:"auto",maxWidth:t+"px"}):$("#inner_column").css({width:t+"px",maxWidth:t+"px"}):void 0},e.prototype.setup_referrer=function(){var t,e;if(!I.ReferrerTracker.has_ref("game",this.game.id)){if(t=$(document.body).data("host"),!(!(e=document.referrer)||e.indexOf(t)>=0))return I.ReferrerTracker.push("game",this.game.id,"game:"+e)}},e}(),I.ViewFlashGame=function(t){function r(t,e,o,i){this.swf=o,r.__super__.constructor.call(this,t,e,i),this.embed_game(),this.setup_hiding("#swf_drop")}return e(r,t),r.prototype.get_size=function(t){var e;return $.get("/"+this.game.slug+"/swf_size/"+this.swf.id,(e=this,function(r){return e.swf.data.swf=r.swf,"function"==typeof t?t():void 0}))},r.prototype.embed_game=function(t){var e,r,o,i,s;if(this.swf)return this.swf.data.swf||t?(i=(o=this.swf.data.swf).width,r=o.height,(null!=(e=swfobject.getFlashPlayerVersion())?e.major:void 0)!==0||window.location.hash.match(/\bforce_flash\b/))?(swfobject.embedSWF(this.swf.url,"swf_drop",i,r,"11.0.0",!1,{},{wmode:"direct",allowfullscreen:"true"}),this.swf_drop=$("#swf_drop"),this.swf_drop.parent().width(i).height(r),this.fit_to_width(i),this.el.addClass("ready")):(this.el.addClass("ready no_flash"),$(document.body).addClass("embed_disabled")):this.get_size((s=this,function(){return s.embed_game(!0)}))},r}(I.ViewGame),I.ViewUnityGame=function(t){function r(t,e,o,i){this.unity=o,r.__super__.constructor.call(this,t,e,i),this.embed_game(),this.setup_hiding("#unity_drop embed")}return e(r,t),r.prototype.embed_game=function(){var t,e,r,o,i;if(this.unity)return(o=(t=$("#unity_drop")).width())>920&&$("#inner_column").width(o+40),r=new UnityObject2({params:{disableContextMenu:!0}}),e=_.once(function(t){return I.event("view_game","unity",""+t)}),r.observeProgress((i=this,function(r){return(e(r.pluginStatus),"unsupported"===r.pluginStatus)?(t.width("").height(""),$("#inner_column").width(""),i.el.addClass("unity_unsupported")):$(document.body).removeClass("responsive")})),r.initPlugin(t[0],this.unity.url)},r}(I.ViewGame),I.ViewJavaGame=function(t){function r(t,e,o,i){this.jar=o,r.__super__.constructor.call(this,t,e,i),this.setup_hiding("#jar_drop applet")}return e(r,t),r}(I.ViewGame),I.ViewHtmlGame=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r}(I.ViewGame)}).call(this),(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.CommunityArchiveTopicLightbox=function(e){function r(){var t,e;return this.init=(t=this.init,e=this,function(){return t.apply(e,arguments)}),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.init=function(){var t,e,r;return this.with_redactor((e=this,function(){return I.redactor(e.el.find("textarea"),{minHeight:100,source:!1})})),t=this.el.find("form").remote_submit(function(e){if(t.set_form_errors(e.errors),!e.errors)return window.location.reload()})},r}(I.Lightbox)}).call(this),(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.CommunityBanLightbox=function(e){function r(){var t,e;return this.init=(t=this.init,e=this,function(){return t.apply(e,arguments)}),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.init=function(){var t,e,r;return this.with_redactor((e=this,function(){return I.redactor(e.el.find("textarea"),{minHeight:100,source:!1})})),t=this.el.find("form").remote_submit((r=this,function(e){if(t.set_form_errors(e.errors),!e.errors)return r.el.addClass("after_ban")}))},r}(I.Lightbox)}).call(this),(function(){I.CommunityCategoryBans=function t(e){var r;this.el=$(e),this.el.remote_link(function(t){if(t.errors){alert(t.errors.join("\n"));return}return window.location.reload()})}}).call(this),(function(){I.CommunityCategoryModerators=function t(e){var r;this.el=$(e),this.el.remote_link(function(t,e){if(t.return_to)return window.location=t.return_to})}}).call(this),(function(){I.CommunityProfile=function t(e,r){var o;this.el=$(e),new I.FilterPickers(this.el),this.carousels=(function(){var t,e,r,i;for(t=0,r=this.el.find(".game_carousel_widget"),i=[],e=r.length;t<e;t++)o=r[t],i.push(new I.GameCarousel($(o)));return i}).call(this),new I.CommunityViewTopic(this.el.find(".recent_posts"),r)}}).call(this),(function(){I.CommunityEditCategory=function t(e){var r,o;this.el=$(e),r=this.el.find("form").remote_submit(function(t){if(t.errors){r.set_form_errors(t.errors);return}if(t.redirect_to)return window.location=t.redirect_to})}}).call(this),(function(){I.GameCommunityCategory=function t(e){var r;this.el=$(e),(r=this.el.find(".blog_post_grid_widget")).lazy_images({horizontal:!0,target:r})}}).call(this),(function(){I.GameCommunityHeader=function t(e){var r;this.el=$(e),this.el.dispatch("click",{add_to_collection_btn:function(t){return I.current_user?I.Lightbox.open_remote(t.attr("href"),I.CollectionLightbox):"continue"}})}}).call(this),(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.CommunityLockTopicLightbox=function(e){function r(){var t,e;return this.init=(t=this.init,e=this,function(){return t.apply(e,arguments)}),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.init=function(){var t,e,r;return this.with_redactor((e=this,function(){return I.redactor(e.el.find("textarea"),{minHeight:100,source:!1})})),t=this.el.find("form").remote_submit(function(e){if(t.set_form_errors(e.errors),!e.errors)return window.location.reload()})},r}(I.Lightbox)}).call(this),(function(){I.CommunityNewTopic=function(){function t(t,e){var r,o;this.el=$(t);try{this.el.find("input[name=offset]").val((new Date).getTimezoneOffset())}catch(i){}this.set_fingerprint(),r=this.el.find("form").remote_submit(function(t){if(t.errors){if(I.add_recaptcha_if_necessary(r,t.errors))return;r.set_form_errors(t.errors);return}if(t.redirect_to)return window.location=t.redirect_to})}return t.prototype.set_fingerprint=function(){var t;return!!window.Fingerprint2&&(this.set_fingerprint=function(){},(new Fingerprint2).get((t=this,function(e){if(e)return t.el.find("input[name=bfp]").val(e)})))},t}()}).call(this),(function(){I.CommunityPostForm=function t(e,r){var o,i;null==r&&(r={}),this.el=$(e),o=this.el.find("form").remote_submit(function(t){if(t.errors){if(I.add_recaptcha_if_necessary(o,t.errors))return;o.set_form_errors(t.errors);return}if(t.redirect_to&&(window.location=t.redirect_to),t.flash)return I.flash(t.flash)})}}).call(this),(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.CommunityReportPostLightbox=function(e){function r(){var t,e;return this.init=(t=this.init,e=this,function(){return t.apply(e,arguments)}),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.init=function(){var t,e;return t=this.el.find("form").remote_submit((e=this,function(r){if(r.errors){t.set_form_errors(r.errors);return}return e.el.addClass("submitted_report")}))},r}(I.Lightbox)}).call(this),(function(){var t=function(t,r){for(var o in r)e.call(r,o)&&(t[o]=r[o]);function i(){this.constructor=t}return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t},e={}.hasOwnProperty;I.CommunityStickTopicLightbox=function(e){function r(){var t,e;return this.init=(t=this.init,e=this,function(){return t.apply(e,arguments)}),r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.init=function(){var t,e,r;return this.with_redactor((e=this,function(){return I.redactor(e.el.find("textarea"),{minHeight:100,source:!1})})),t=this.el.find("form").remote_submit(function(e){if(t.set_form_errors(e.errors),!e.errors)return window.location.reload()})},r}(I.Lightbox)}).call(this),(function(){I.CommunityTopicHeader=function(){function t(t,e){var r,o,i;this.opts=e,this.render_topic_voter=(o=this.render_topic_voter,i=this,function(){return o.apply(i,arguments)}),this.el=$(t),(r=this.el.find(".moderation_tools")).length&&new I.CommunityTopicModerationTools(r,this.opts.moderation),this.render_topic_voter()}return t.prototype.render_topic_voter=function(){var t,e,r;if(("undefined"!=typeof R&&null!==R&&null!=(e=R.Community)?e.TopicVoter:void 0)&&(r=this.el.find(".community_topic_voter_widget")).length)return(t=r.data("p")).vote_url=this.opts.vote_url,ReactDOM.render(R.Community.TopicVoter(t),r[0])},t}()}).call(this),(function(){I.CommunityTopicList=function(){function t(t,e){this.opts=e,this.el=$(t),new I.CommunityTopicModerationTools(t,this.opts),this.el.lazy_images({selector:"[data-background_image]"}),this.render_topic_voters(),this.el.has_tooltips(),new I.GamePopups(this.el)}return t.prototype.render_topic_voters=function(){var t,e,r,o,i,s,n;if("undefined"!=typeof R&&null!==R&&null!=(o=R.Community)?o.TopicVoter:void 0){for(t=0,i=this.el.find(".community_topic_voter_widget"),s=[],e=i.length;t<e;t++)(r=$(n=i[t]).data("p")).vote_url=this.opts.vote_url,s.push(ReactDOM.render(R.Community.TopicVoter(r),n));return s}},t}()}).call(this),(function(){I.CommunityTopicModerationTools=function(){function t(t,e){var r,o,i;this.opts=e,this.topic_url=(r=this.topic_url,o=this,function(){return r.apply(o,arguments)}),this.el=$(t),new I.FilterPickers(t),this.el.on("click",".filter_option",(i=this,function(t){var e,r,o;switch(r=(e=$(t.currentTarget).trigger("i:close_filter_pickers")).closest("[data-topic_id]").data("topic_id"),o=null!=e?e.data("value"):void 0){case"purge":if(t.preventDefault(),confirm("This will delete all the users posts and spam their account. No undo. Are you sure?"))return $.post($(t.currentTarget).attr("href"),I.with_csrf()).done(function(t){if(t.errors){alert(t.errors.join(","));return}if(t.redirect_to)return window.location=t.redirect_to});break;case"feature":case"unfeature":case"bump":return t.preventDefault(),$.post($(t.currentTarget).attr("href"),I.with_csrf()).done(function(t){if(t.errors){alert(t.errors.join(","));return}if(t.redirect_to)return window.location=t.redirect_to});case"archive":case"unarchive":return t.preventDefault(),I.Lightbox.open_remote(i.topic_url("archive_topic",r),I.CommunityArchiveTopicLightbox);case"lock":case"unlock":return t.preventDefault(),I.Lightbox.open_remote(i.topic_url("lock_topic",r),I.CommunityLockTopicLightbox);case"stick":case"unstick":return t.preventDefault(),I.Lightbox.open_remote(i.topic_url("stick_topic",r),I.CommunityStickTopicLightbox);case"delete":if(t.preventDefault(),confirm("Are you sure you want to delete this topic?"))return $.ajax({url:i.topic_url("delete_topic",r),data:I.with_csrf(),type:"post",xhrFields:{withCredentials:!0}}).done(function(t){return t.errors?alert(t.errors.join()):window.location.reload()})}}))}return t.prototype.topic_url=function(t,e){return this.opts.urls[t].replace(/:topic_id\b/,e)},t}()}).call(this),(function(){I.CommunityViewTopic=function(){function t(t,e){var r,o,i,s,n,a,l,u,p;this.opts=e,this.update_votes=(o=this.update_votes,i=this,function(){return o.apply(i,arguments)}),this.el=$(t),this.el.find("code[class*=language-]").exists()&&(r=$("#lib_prism_src").data("inject"))&&$(document.body).append(r),this.el.remote_link((s=this,function(t,e){if(e.is(".vote_btn")){if(t.errors){alert(t.errors.join(", "));return}s.update_votes(e,t);return}if(t.redirect_to)return window.location=t.redirect_to})),this.el.dispatch("click",{ban_user_btn:(n=this,function(t){var e,r;return r=t.closest(".community_post").data("post"),e=n.opts.ban_url+"?banned_user_id="+r.user_id,I.Lightbox.open_remote(e,I.CommunityBanLightbox)}),stick_topic_btn:function(t){return I.Lightbox.open_remote(t.data("href"),I.CommunityStickTopicLightbox)},lock_topic_btn:function(t){return I.Lightbox.open_remote(t.data("href"),I.CommunityLockTopicLightbox)},report_post_btn:(u=this,function(t){var e,r;return e=t.closest(".community_post").data("post"),r=u.opts.report_url.replace(/:post_id/,e.id),I.Lightbox.open_remote(r,I.CommunityReportPostLightbox)}),embed_preload:function(t){var e;if(t[0].hasAttribute("itchio"))return e=t.data("embed_code"),t.replaceWith(e)}})}return t.prototype.vote_counts_template=I.lazy_template(t,"vote_counts"),t.prototype.update_votes=function(t,e){var r,o,i,s,n,a,l,u,p;for(((i=(a=(s=t.closest(".community_post")).find(".vote_btn")).filter(".post_action")).removeClass("animate_bounce animate_drop_down"),setTimeout(function(){return i.removeClass("animate_bounce animate_drop_down")},500),t.is(".voted"))?(_.defer(function(){return i.addClass("animate_drop_down")}),t.removeClass("voted")):(_.defer(function(){return i.addClass("animate_bounce")}),a.removeClass("voted").filter(t).addClass("voted")),r=0,o=a.length;r<o;r++)(n=$(n=a[r])).is(".voted")?n.data("params").action="remove":delete n.data("params").action;return s.find(".vote_counts").html(this.vote_counts_template({up_score:e.up_score+Math.max(0,e.score_adjustment),down_score:e.down_score+Math.abs(Math.min(0,e.score_adjustment))}))},t}()}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,(t=R.package("Index"))("LazyImage",{pure:!0,propTypes:{src:(E=PropTypes).string,src_set:E.string,width:E.number,height:E.number},getInitialState:function(){return{visible:!1}},componentDidMount:function(){var t,e;return t=ReactDOM.findDOMNode(this),this.unbind_lazy_images=$(t).lazy_images({elements:[t],show_images:(e=this,function(){var t;return e.setState({visible:!0}),"function"==typeof(t=e.props).on_reveal?t.on_reveal():void 0})})},componentWillUnmount:function(){return"function"==typeof this.unbind_lazy_images?this.unbind_lazy_images():void 0},render:function(){var t,e,r;return b({className:classNames(this.props.class,this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:null!=(t=this.props.initial_width)?t:this.props.width,height:this.state.loaded?this.props.height:null!=(e=this.props.initial_height)?e:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?(r=this,function(){var t;return r.setState({loaded:!0}),"function"==typeof(t=r.props).on_load?t.on_load():void 0}):void 0})}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G,V,q,A,O,M,U;a=(e=ReactDOMFactories).div,F=e.span,r=e.a,i=e.br,T=e.p,C=e.ol,U=e.ul,N=e.li,P=e.strong,l=e.em,y=e.img,p=e.form,k=e.label,w=e.input,q=e.textarea,s=e.button,b=e.iframe,d=e.h1,h=e.h2,m=e.h3,f=e.h4,g=e.h5,v=e.h6,j=e.pre,n=e.code,z=e.select,L=e.option,D=e.section,S=e.optgroup,u=e.fieldset,x=e.legend,(c=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Community"),M=PropTypes,E=ReactDOMFactories.table,A=ReactDOMFactories.thead,G=ReactDOMFactories.tbody,O=ReactDOMFactories.tr,V=ReactDOMFactories.td,o=ReactDOMFactories.abbr,t("CategoryEditTags",{propTypes:{tags:M.arrayOf(M.shape({id:M.number.isRequired,label:M.string.isRequired,color:M.string}))},getInitialState:function(){return{tags:_.toArray(this.props.tags)}},push_tag:function(t){if(""!==(t=$.trim(t)))return this.setState(function(e){return{tags:e.tags.concat({label:t})}})},remove_tag:function(t){return this.state.tags.splice(t,1),this.forceUpdate()},input_name:function(t,e){return"category_tags["+(e+1)+"]["+t+"]"},render:function(){var t,e;return this.enclose({},this.state.tags.length?E({className:"tag_list"},G({},this.state.tags.map((t=this,function(e,r){return O({className:"tag_row",key:e.id+"-"+e.label},V({},null!=e.id?w({type:"hidden",name:t.input_name("id",r),value:""+e.id}):void 0,null!=e.color?w({type:"hidden",name:t.input_name("color",r),value:e.color}):void 0,w({type:"hidden",name:t.input_name("label",r),value:e.label}),F({className:"tag_label"},e.label)),V({},w({type:"text",name:t.input_name("description",r),defaultValue:e.description,placeholder:"Description, optional"})),V({},s({className:"textlike",onClick:function(e){if(confirm("Are you sure you want to remove this tag?"))return e.preventDefault(),t.remove_tag(r)}},"remove")))})))):void 0,w({type:"text",placeholder:"Type tag name and press enter to add tag",maxLength:30,onKeyDown:(e=this,function(t){if(13===t.keyCode)return t.preventDefault(),e.push_tag(t.target.value),t.target.value=""})}))}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G,V,q=[].slice;n=(e=ReactDOMFactories).div,F=e.span,r=e.a,o=e.br,T=e.p,C=e.ol,V=e.ul,N=e.li,P=e.strong,a=e.em,b=e.img,u=e.form,k=e.label,y=e.input,E=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,j=e.pre,s=e.code,z=e.select,L=e.option,D=e.section,S=e.optgroup,l=e.fieldset,x=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Community"),w=0,t("EditCategories",{propTypes:{category:(G=PropTypes).object},getInitialState:function(){return{children:_.toArray(this.props.category.children)}},componentDidMount:function(){var t,e,r,o,i,s,n;return this.dispatch("category",{create:(t=this,function(){return t.state.children.push({key:w+=1}),t.forceUpdate()}),set_property:(e=this,function(t,r,o,i){return r[o]=i,e.forceUpdate()}),create_child:(r=this,function(t,e){return e.children||(e.children=[]),e.children.push({key:w+=1}),r.forceUpdate()}),remove_child:(o=this,function(t,e,r){var i;return(i=e===o.props.category?o.state.children:e.children).splice(r,1),o.forceUpdate()}),toggle:(i=this,function(t,e,r){return e[r]=!e[r],i.forceUpdate()}),move_up:(s=this,function(t,e,r){var o,i,n,a;if((i=e===s.props.category?s.state.children:e.children)[a=r-1])return n=[(o=i)[a],o[r]],o[r]=n[0],o[a]=n[1],s.forceUpdate()}),move_down:(n=this,function(t,e,r){var o,i,s,a;if((i=e===n.props.category?n.state.children:e.children)[a=r+1])return s=[(o=i)[a],o[r]],o[r]=s[0],o[a]=s[1],n.forceUpdate()})})},render:function(){var e,r;return u({method:"POST",className:"edit_categories form"},R.CSRF({}),d({},"Subcategories"),this.state.children.length?n({className:"category_list",children:_.map(this.state.children,(e=this,function(r,o){return t.CategoryRow({is_first:0===o,is_last:o===e.state.children.length-1,key:r.key||"cat"+r.id,parent_category:e.props.category,category:r,position:o+1})}))}):T({},a({className:"empty_message"},"There are no categories. You must have at least one non-directory category for your community to be usable.")),n({className:"button_row"},i({className:"button",onClick:(r=this,function(t){return t.preventDefault(),r.trigger("category:create")})},"New category")," ",i({className:"button"},"Save")))}}),t("CategoryRow",{propTypes:{is_first:G.bool,is_last:G.bool,position:G.number,category:G.shape({id:G.number,title:G.string}),input_prefix:G.string},input_name:function(t){var e;return(e=this.props.input_prefix||"categories")+"["+(this.props.position||"")+"]["+t+"]"},render:function(){var e,o,i,s,a,l;return n({className:"category_row"},this.props.category.id?y({type:"hidden",name:this.input_name("id"),value:this.props.category.id}):void 0,n.apply(null,[{className:"category_primary_inputs"}].concat(q.call(this.render_title_inputs()))),n.apply(null,[{className:"category_secondary_inputs"}].concat(q.call(this.render_button_inputs()))),n({className:"category_secondary_inputs"},k({},y({type:"checkbox",name:this.input_name("archived"),checked:this.props.category.archived||!1,onChange:(i=this,function(t){return i.trigger("category:toggle",i.props.category,"archived")})}),F({className:"label"},"Archive")),k({},y({type:"checkbox",name:this.input_name("hidden"),checked:this.props.category.hidden||!1,onChange:(s=this,function(t){return s.trigger("category:toggle",s.props.category,"hidden")})}),F({className:"label"},"Hidden")),k({},y({type:"checkbox",name:this.input_name("directory"),checked:this.props.category.directory||!1,onChange:(a=this,function(t){return a.trigger("category:toggle",a.props.category,"directory")})}),F({className:"label"},"Directory")),this.props.category.created_at?F({className:"created_at",title:this.props.category.created_at},I.format_timestamp(this.props.category.created_at,"calendar")):void 0,this.props.category.directory||null==this.props.category.topics_count?void 0:F({className:"topics_count"},(e=this.props.category.topics_count)+" topics"),this.props.category.url?r({className:"category_link",href:this.props.category.url},"View"):void 0,this.props.category.edit_url?r({className:"category_link",href:this.props.category.edit_url},"Edit"):void 0),(null!=(o=this.props.category.children)?o.length:void 0)?n({className:"child_categories",children:_.map(this.props.category.children,(l=this,function(e,r){return t.CategoryRow({is_first:0===r,is_last:r===l.props.category.children-1,key:e.key||"cat"+e.id,input_prefix:(l.props.input_prefix||"categories")+"["+l.props.position+"][children]",parent_category:l.props.category,category:e,position:r+1})}))}):void 0)},render_title_inputs:function(){var t,e;return[this.props.category.id?void 0:F({className:"new_flag"},"New"),y({type:"text",className:"title_input text_input",name:this.input_name("title"),required:"required",value:this.props.category.title||"",placeholder:"Title",onChange:(t=this,function(e){return t.trigger("category:set_property",t.props.category,"title",e.target.value)})}),this.props.category.directory?void 0:y({type:"text",className:"short_description_input text_input",name:this.input_name("short_description"),value:this.props.category.short_description||"",placeholder:"Short description",onChange:(e=this,function(t){return e.trigger("category:set_property",e.props.category,"short_description",t.target.value)})})]},render_button_inputs:function(){var t,e,o,s;return[i({className:"button small",onClick:(t=this,function(e){return e.preventDefault(),t.trigger("category:create_child",t.props.category)})},"Add child"),this.props.is_first?void 0:r({href:"#",className:"move_btn move_up_btn",onClick:(e=this,function(t){return t.preventDefault(),e.trigger("category:move_up",e.props.parent_category,e.props.position-1)})},"Move up"),this.props.is_last?void 0:r({href:"#",className:"move_btn move_down_btn",onClick:(o=this,function(t){return t.preventDefault(),o.trigger("category:move_down",o.props.parent_category,o.props.position-1)})},"Move down"),r({href:"#",className:"remove_btn",onClick:(s=this,function(t){if(t.preventDefault(),confirm("Are you sure you want to remove?"))return s.trigger("category:remove_child",s.props.parent_category,s.props.position-1)})},"Remove")]}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G,V={}.hasOwnProperty,q=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return -1};n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Community"),E=PropTypes,t("PostLiker",{pure:!0,getDefaultProps:function(){return{animation_duration:500}},componentDidCatch:function(t,e){return I.event("error","react","Community.PostLiker")},componentWillUnmount:function(){if(this.animation_timer)return window.clearTimeout(this.animation_timer),this.animation_timer=null},componentDidUpdate:function(t,e){var r,o;if((null!=(r=this.state)?r.animation:void 0)&&(null!=e?e.animation:void 0)!==this.state.animation)return this.animation_timer=window.setTimeout((o=this,function(){return o.setState({animation:null})}),this.props.animation_duration)},like:function(){var t,e,r,o,i,s,n,a;return r={direction:"up"},(null!=(o=this.props.vote)?o.positive:void 0)&&(r.action="remove"),t="remove"===r.action?"animate_drop_down":"animate_bounce",(null!=(i=this.state)?i.animation:void 0)&&(e=t,_.defer((s=this,function(){return s.setState({animation:e})})),t=null),this.setState({loading:!0,pending_vote:"remove"!==r.action,animation:t}),$.ajax({type:"POST",dataType:"json",url:this.props.urls.vote_url({id:this.props.post_id}),data:I.with_csrf(r),xhrFields:{withCredentials:!0}}).done((n=this,function(t){var e;return n.setState({loading:!1,pending_vote:void 0}),"function"==typeof(e=n.props).on_vote?e.on_vote(t):void 0})).fail((a=this,function(t){var e;if(a.setState({loading:!1}),(null!=(e=function(){try{return JSON.parse(t.responseText)}catch(e){}}())?e.errors:void 0)&&a.setState({pending_vote:null}),null!=e?e.login_url:void 0)return window.location=e.login_url}))},render:function(){var t,e,r,o,i,s;return this.props.current_user?this.enclose({component:"button",type:"button",className:classNames("post_action vote_btn",null!=(t=this.state)?t.animation:void 0,this.props.classNames,{loading:null!=(e=this.state)?e.loading:void 0,voted:null!=(r=null!=(o=this.state)?o.pending_vote:void 0)?r:null!=(i=this.props.vote)?i.positive:void 0}),onClick:this.on_click||(this.on_click=(s=this,function(t){return t.preventDefault(),s.like()}))},R.Icons.TriUp," ",this.tt("community.post_list.like")):this.enclose({component:"a",className:classNames("post_action vote_btn",this.props.classNames),href:this.props.login_url,target:"_blank"},R.Icons.TriUp," ",this.tt("community.post_list.like"))}}),t("PostVoter",{pure:!0,propTypes:{urls:E.object,post_id:E.number,vote:E.object},componentDidCatch:function(t,e){return I.event("error","react","Community.PostVoter")},vote:function(t){var e,r,o,i,s;if(null==(r=this.state)||!r.loading)return e={direction:t},"up"===t&&(null!=(o=this.props.vote)?o.positive:void 0)&&(e.action="remove"),"down"===t&&this.props.vote&&!this.props.vote.positive&&(e.action="remove"),this.setState({loading:!0}),$.ajax({type:"POST",url:this.props.urls.vote_url({id:this.props.post_id}),data:I.with_csrf(e),dataType:"json",xhrFields:{withCredentials:!0}}).done((i=this,function(t){var e;return i.setState({loading:!1}),"function"==typeof(e=i.props).on_vote?e.on_vote(t):void 0})).fail((s=this,function(t){var e;if(s.setState({loading:!1}),null!=(e=function(){try{return JSON.parse(t.responseText)}catch(e){}}())?e.login_url:void 0)return window.location=e.login_url}))},render:function(){var t,e,o;return this.enclose({className:classNames("post_votes",{loading:null!=(t=this.state)?t.loading:void 0})},this.props.current_user?i({type:"button",disabled:this.props.disabled,className:classNames("vote_up_btn vote_btn",{voted:this.props.vote&&this.props.vote.positive}),onClick:this.on_vote_up||(this.on_vote_up=(e=this,function(){return e.vote("up")}))},R.Icons.TriUp):r({className:"vote_up_btn vote_btn",target:"_blank",rel:"nofollow",href:this.props.login_url},R.Icons.TriUp),this.props.current_user?i({type:"button",disabled:this.props.disabled,className:classNames("vote_down_btn vote_btn",{voted:this.props.vote&&!this.props.vote.positive}),onClick:this.on_vote_down||(this.on_vote_down=(o=this,function(){return o.vote("down")}))},R.Icons.TriDown):r({className:"vote_down_btn vote_btn",target:"_blank",rel:"nofollow",href:this.props.login_url},R.Icons.TriDown))}}),t("PostBody",{pure:!0,getDefaultProps:function(){return{max_height:300}},componentDidMount:function(){var t;return _.defer((t=this,function(){var e,r;return e=(r=$(t.wrapper_ref.current).find("img").on("load",function(){return t.refresh_sizes()})).length?void 0:50,t.refresh_sizes(e)}))},reveal:function(){return this.setState({open:!0,has_more:!1})},on_click:function(t){var e,r,o;if((null!=(r=this.state)?r.has_more:void 0)&&this.reveal(),(e=$(t.target).closest(".embed_preload")).length&&(s=e.data("embed_code"),e.replaceWith(s),!(null!=(o=this.state)?o.open:void 0)))return this.setState({open:!0})},refresh_sizes:function(t){var e;if(this.wrapper_ref.current&&((e=this.wrapper_ref.current.scrollHeight)>this.props.max_height&&this.setState({has_more:!0}),t&&e<this.props.max_height+t))return this.setState({open:!0,has_more:!1})},render:function(){var t,e,r;return r=(null!=(t=this.state)?t.open:void 0)?void 0:{overflowY:"hidden",maxHeight:this.props.max_height+"px"},p({},n({className:"post_body user_formatted",ref:this.wrapper_ref||(this.wrapper_ref=React.createRef()),style:r,onClick:this.on_click,dangerouslySetInnerHTML:{__html:this.props.body_html}}),(null!=(e=this.state)?e.has_more:void 0)?i({type:"button",onClick:this.reveal,className:"reveal_full_post_btn"},"View rest ↓"):void 0)}}),t("Post",{pure:!0,edit_post:function(t){return this.props.edit_post(this.props.post,t)},is_redacted:function(){var t,e,r,o,i;return t=this.props.post,i=this.props.post.user,!!t.deleted||null!=(e=t.user)&&!!e.deleted||(null!=(r=t.user)&&!!r.suspended||!!t.blocked)&&!(null!=(o=this.state)?o.show_blocked:void 0)},render:function(){var t,e;return t=this.props.post,p({},this.render_current_post(),(null!=(e=t.replies)?e.length:void 0)?this.render_children():t.view_replies_url?n({className:"view_more_replies"},r({href:t.view_replies_url,className:"button outline forward_link"},this.tt("community.post_list.view_more_in_thread"))):void 0)},render_children:function(){var e,r;return n({className:classNames("community_post_replies",{top_level_replies:1===(e=this.props.post).depth})},e.replies.map((r=this,function(e,o){return t.Post({key:e.id,readonly:r.props.readonly,idx:o,post:e,current_user:r.props.current_user,edit_post:r.edit_child_post||(r.edit_child_post=function(t,e){var o;return r.edit_post({replies:(function(){var r,i,s,n;for(r=0,s=this.props.post.replies,n=[],i=s.length;r<i;r++)if((o=s[r])===t){if("remove"===e)continue;n.push($.extend({},t,e))}else n.push(o);return n}).call(r)})}),urls:r.props.urls,reply_form_params:r.props.reply_form_params})})))},update_vote:function(t){var e,r,o;return o=Math.max(r=t.score_adjustment||0,0),e=Math.min(r,0),this.edit_post({up_votes:t.up_score+o,down_votes:t.down_score-e,vote:t.score_adjustment?{positive:t.score_adjustment>0}:null})},delete_post:function(t){var e,r,o,i,s,n,a;if(null==t&&(t=null),i=this.props.post,confirm(r="hard"===t?"Purging post will delete it permanently, along with any replies. Continue?":"Are you sure you want to delete this post?")&&(null==(s=this.state)||!s.deleting))return this.setState({deleting:!0}),e=this.props.urls.delete_url({id:i.id}),o={},"hard"===t&&(o.hard="1"),$.ajax({type:"POST",url:e,data:I.with_csrf(o),dataType:"json",xhrFields:{withCredentials:!0}}).done((n=this,function(t){return n.edit_post({deleted:!0,hard_deleted:"hard"===t.type})})).always((a=this,function(){return a.setState({deleting:!1})}))},render_current_post_moderation_event:function(){var t,e,o,s;return(e=this.props.post,o=this.props.post.user,t=e.moderation_event,e.deleted)?n({className:"post_content"},n({className:"post_body"},a({className:"deleted_message"},this.tt("community.post_list.deleted_post")))):p({},z({className:"post_author"},o.url&&o.name?r({href:o.url},o.name):z({className:"name_placeholder"},"Unknown account")),z({className:"moderation_action"},F({},t.action),t.target_name?p({}," ",r({href:t.target_url},t.target_name)):void 0," ",z({className:"post_date",title:e.created_at+" UTC"},r({href:e.url},I.format_timestamp(e.created_at))),!e.can_delete||e.deleted||this.props.readonly?void 0:i({className:"textlike delete_post_btn post_action",type:"button",onClick:(s=this,function(t){return t.preventDefault(),s.delete_post()})},this.tt("community.post_list.delete"))))},render_current_post_contents:function(){var e,o,s,l,u,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L;return u=this.props.post,b=this.props.post.user,e=R.Index.LazyImage({className:"post_avatar",width:25,height:25,src:b.avatar_url,src_set:b.avatar_url2x?b.avatar_url+" 1x, "+b.avatar_url2x+" 2x":void 0}),(u.just_added?R.SlideDown:n)({className:"post_grid"},"ud"===u.vote_types?t.PostVoter({post_id:u.id,vote:u.vote,disabled:this.is_redacted(),urls:this.props.urls,on_vote:this.update_vote,current_user:this.props.current_user,login_url:"function"==typeof(o=this.props.urls).login_url?o.login_url():void 0}):void 0,b.url?r({href:b.url,className:"avatar_container"},e):n({className:"avatar_container"},e),n({className:"post_header"},z({className:"post_author"},u.deleted?z({className:"name_placeholder"},"Deleted post"):b.deleted?z({className:"name_placeholder"},this.tt("community.post_list.deleted_account")):!u.blocked||(null!=(c=this.state)?c.show_blocked:void 0)?b.suspended?z({className:"name_placeholder"},this.tt("community.post_list.suspended_account")):b.url&&b.name?r({href:b.url},b.name):void 0:z({className:"name_placeholder"},"Blocked account")),z({className:"post_date",title:u.created_at+" UTC"},r({href:u.url},I.format_timestamp(u.created_at))),!this.is_redacted()&&(u.edits_count||0)>0?p({}," ",z({className:"edit_message",title:u.edited_at+" ("+u.edits_count+")"},this.tt("community.post_list.edited"))):void 0,!this.is_redacted()&&u.vote_types&&(u.up_votes||u.down_votes)?z({className:"vote_counts"},u.up_votes?z({className:"upvotes"},"(+"+u.up_votes+")"):void 0,u.down_votes?z({className:"downvotes"},"(-"+u.down_votes+")"):void 0):void 0),n({className:"post_content"},u.deleted||(null!=(d=u.user)?d.deleted:void 0)?n({className:"post_body"},a({className:"deleted_message"},this.tt("community.post_list.deleted_post")),(u.can_moderate||u.admin_url)&&!u.hard_deleted?p({}," (",i({className:"textlike",onClick:this.purge_post||(this.purge_post=(y=this,function(t){return t.preventDefault(),y.delete_post("hard").done(function(){return y.edit_post("remove")})}))},"Purge"),")"):void 0):(null!=(h=u.user)?h.suspended:void 0)&&!(null!=(m=this.state)?m.show_blocked:void 0)?n({className:"post_body"},a({},this.tt("community.post_list.post_from_suspended_account"))," (",i({className:"textlike",onClick:this.show_blocked_post||(this.show_blocked_post=(w=this,function(){return w.setState({show_blocked:!0})}))},"Show post"),")"):!u.blocked||(null!=(f=this.state)?f.show_blocked:void 0)?(null!=(g=this.state)?g.editing:void 0)?this.render_edit_form():t.PostBody({key:u.body_html,body_html:u.body_html}):n({className:"post_body"},a({},this.tt("community.post_list.post_from_blocked_account"))," (",i({className:"textlike",onClick:this.show_blocked_post||(this.show_blocked_post=(k=this,function(){return k.setState({show_blocked:!0})}))},"Show post"),", ",r({href:this.props.urls.blocks_url(),target:"_blank"},this.tt("community.post_list.edit_blocks")),")"),n({className:"post_footer"},this.is_redacted()?void 0:"u"===u.vote_types?t.PostLiker({post_id:u.id,vote:u.vote,urls:this.props.urls,on_vote:this.update_vote,current_user:this.props.current_user,login_url:"function"==typeof(s=this.props.urls).login_url?s.login_url():void 0}):void 0,this.is_redacted()||this.props.readonly?void 0:u.can_reply?r({href:this.props.urls.reply_url({id:u.id}),className:"post_action reply_btn",onClick:this.props.reply_form_params?this.on_click_reply||(this.on_click_reply=(x=this,function(t){return t.preventDefault(),x.setState(function(t){return null==t&&(t={}),{replying_to:!t.replying_to}})})):void 0},this.tt("community.post_list.reply")):!this.props.current_user&&this.props.urls.login_url?r({href:"function"==typeof(l=this.props.urls).login_url?l.login_url():void 0,className:"post_action reply_btn",rel:"nofollow",target:"_blank"},this.tt("community.post_list.reply")):void 0,u.can_edit&&!this.props.readonly?r({href:this.props.urls.edit_url({id:u.id}),className:"post_action",onClick:this.props.reply_form_params?this.on_click_edit||(this.on_click_edit=(N=this,function(t){return t.preventDefault(),N.setState(function(t){return null==t&&(t={}),{editing:!t.editing,replying_to:!1}})})):void 0},this.tt("community.post_list.edit")):void 0,!u.can_delete||u.deleted||this.props.readonly?void 0:r({href:"#",className:"post_action delete_post_btn",onClick:(C=this,function(t){return t.preventDefault(),C.delete_post()})},u.is_topic?this.tt("community.post_list.delete_topic"):this.tt("community.post_list.delete")),!this.is_redacted()&&u.can_report?r({href:"#",className:"post_action render_post_btn",onClick:(S=this,function(t){var e;return t.preventDefault(),e=S.props.urls.report_url({id:u.id}),I.Lightbox.open_remote(e,I.CommunityReportPostLightbox)})},this.tt("community.post_list.report")):void 0,b.id&&u.ban_target&&!this.props.readonly?r({href:"#",className:"post_action ban_user_btn",onClick:(L=this,function(t){var e;return t.preventDefault(),e=L.props.urls.ban_url(u.ban_target),e+="?banned_user_id="+b.id,I.Lightbox.open_remote(e,I.CommunityBanLightbox)})},F({},this.tt("community.post_list.ban"))):void 0,u.admin_url?r({href:u.admin_url},"Admin"):void 0),(null!=(v=this.state)?v.replying_to:void 0)?this.render_reply_form():void 0))},render_edit_form:function(){var e,r,o;return e=this.props.post,this.edit_form_cancel||(this.edit_form_cancel=p({}," ",i({type:"button",className:"textlike",onClick:(r=this,function(){return r.setState({editing:!1})})},"Cancel"))),t.PostEditForm({edit_url:this.props.urls.edit_url({id:e.id}),more_buttons:this.edit_form_cancel,reply_form_params:this.props.reply_form_params,on_create_post:(o=this,function(t){return o.edit_post(t),o.setState({editing:!1})})})},render_reply_form:function(){var e,r;return R.SlideDown({},t.PostForm($.extend({submit_url:this.props.urls.reply_url({id:this.props.post.id}),autofocus:!0,open:!0,className:"inline_reply",key:"post-"+((null!=(e=this.state)?e.post_counter:void 0)||0),post_label:this.tt("community.post_form.post_reply"),remember_key:"reply:"+this.props.post.id,on_create_post:this.on_add_reply||(this.on_add_reply=(r=this,function(t){return t.just_added=!0,r.setState(function(t){return{replying_to:!1,post_counter:(t.post_counter||0)+1}}),r.edit_post({replies:[t].concat(r.props.post.replies||[])})}))},this.props.reply_form_params)))},render_current_post:function(){var t,e,r,o;return t=this.props.post,this.enclose({className:classNames("community_post",{disabled:t.deleted||(null!=(e=t.user)?e.suspended:void 0)||(null!=(r=t.user)?r.deleted:void 0)||t.blocked,is_deleted:t.deleted,is_reply:t.depth>1,is_blocked:t.blocked,is_suspended:null!=(o=t.user)?o.suspended:void 0,has_replies:t.replies&&t.replies.length,has_vote_column:"ud"===t.vote_types,moderation_event:t.moderation_event}),id:"post-"+t.id},this.props.len_posts&&0===this.props.idx?n({className:"post_anchor",id:"first-post"}):void 0,this.props.len_posts&&this.props.idx===this.props.len_posts-1?n({className:"post_anchor",id:"last-post"}):void 0,t.moderation_event?this.render_current_post_moderation_event():this.render_current_post_contents())}}),t("PostList",{pure:!0,propTypes:{children:E.array,urls:E.object},componentDidCatch:function(t,e){return I.event("error","react","Community.PostList"),this.setState({critical_error:!0})},render:function(){var e,o,i;return(null!=(e=this.state)?e.critical_error:void 0)?h({},"There was an error rendering the comments, please ",r({href:"https://itch.io/support"},"contact support")," with a link to this page."):this.props.posts?(this.url_templates||(this.url_templates=(o=this,function(){var t,e,r,i;for(t in e={},r=o.props.urls)V.call(r,t)&&(i=r[t],e[t]=_.template(i));return e})()),this.enclose({},this.props.posts.map((i=this,function(e,r){var o;return o=0===r?i.first_post_ref||(i.first_post_ref=React.createRef()):void 0,t.Post({ref:o,key:e.id,readonly:i.props.readonly,idx:r,edit_post:i.props.edit_post,len_posts:i.props.posts.length,post:e,current_user:i.props.current_user,urls:i.url_templates,reply_form_params:i.props.reply_form_params})})))):null}}),t("LoadOnScroll",{componentWillUnmount:function(){return"function"==typeof this.unbind_visibility?this.unbind_visibility():void 0},componentDidMount:function(){var t,e;return t=ReactDOM.findDOMNode(this),this.unbind_visibility=$(t).lazy_images({elements:[t],show_images:(e=this,function(){var t;return null!=(t=e.props)?t.on_seen():void 0})})},render:function(){return this.props.children}}),t("PostEditForm",{propTypes:{edit_url:E.string.isRequired},componentDidCatch:function(t,e){return I.event("error","react","Community.PostEditForm"),this.setState({critical_error:!0})},getInitialState:function(){return{loading:!0}},componentDidMount:function(){var t;return $.ajax({type:"GET",dataType:"json",url:this.props.edit_url,xhrFields:{withCredentials:!0}}).done((t=this,function(e){return t.setState({loading:!1,errors:e.errors,body_format:e.body_format,body:e.body})}))},render:function(){var e;return(null!=(e=this.state)?e.critical_error:void 0)?h({},"There was an error editing this post, please ",r({href:"https://itch.io/support"},"contact support")," with a link to this page."):this.state.body?t.PostForm($.extend({},this.props.reply_form_params,{submit_url:this.props.edit_url,autofocus:!0,open:!0,className:"inline_edit",defaultValue:this.state.body,body_format:this.state.body_format,post_label:this.tt("misc.forms.save"),more_buttons:this.props.more_buttons,on_create_post:this.props.on_create_post})):n({},"")}}),t("PostForm",{getInitialState:function(){return{open:this.props.open||!1}},componentDidCatch:function(t,e){return I.event("error","react","Community.PostForm")},render:function(){return this.enclose({},this.state.open?this.render_form():this.render_pre_form())},render_pre_form:function(){var t;return u({className:classNames("form post_form",this.props.className)},y({className:"click_input",type:"text",placeholder:this.t("game.comments.write_your_comment"),onFocus:(t=this,function(){return t.setState({open:!0,focus:!0})})}))},render_form:function(){var t,e,r,o;return u({action:this.props.submit_url,ref:this.form_ref||(this.form_ref=React.createRef()),className:classNames("form post_form",this.props.className),onSubmit:(o=this,function(t){var e;if(null==(e=o.state)||!e.loading)return t.preventDefault(),o.setState({loading:!0}),I.remote_submit($(t.target),[{name:"format",value:"props"}]).done(function(t){var e,r;if(t.errors){o.setState({needs_recaptcha:q.call(t.errors,"recaptcha")>=0,errors:t.errors,loading:!1});return}if(t.flash&&I.flash(t.flash),null!=(r=o.body_input_ref.current)&&r.clear_memory(),o.setState({loading:!1,needs_recaptcha:!1,errors:null}),t.post)return"function"==typeof(e=o.props).on_create_post?e.on_create_post(t.post):void 0})})},(null!=(t=this.state)?t.errors:void 0)?R.Forms.FormErrors({errors:this.state.errors,animated:!0,scroll_into_view:!0}):void 0,R.CSRF({}),this.props.body_format?y({type:"hidden",name:"post[body_format]",value:this.props.body_format}):void 0,(function(){switch(this.props.body_format||"html"){case"html":return R.Redactor({placeholder:"Required",ref:this.body_input_ref||(this.body_input_ref=React.createRef()),remember_key:this.props.remember_key,name:"post[body]",required:!0,defaultValue:this.props.defaultValue,redactor_opts:$.extend({minHeight:50,focus:this.props.autofocus||this.state.focus},this.props.redactor_opts)});case"markdown":var t;return R.Forms.MarkdownInput({ref:this.body_input_ref||(this.body_input_ref=React.createRef()),remember_key:this.props.remember_key,placeholder:"Required",defaultValue:this.props.defaultValue,name:"post[body]",autofocus:this.props.autofocus||this.state.focus,required:!0,on_submit_hotkey:this.on_submit_hotkey_callback||(this.on_submit_hotkey_callback=(t=this,function(){var e,r;return null!=(e=t.submit_button_ref)&&null!=(r=e.current)?r.click():void 0}))});default:return R.Forms.FormErrors({animated:!0,scroll_into_view:!0,errors:["Don't know how to edit post with format "+this.state.body_format]})}}).call(this),(null!=(e=this.state)?e.needs_recaptcha:void 0)?R.Forms.RecaptchaInput({sitekey:this.props.recaptcha_sitekey}):void 0,n({className:"buttons"},i({className:"button",disabled:null!=(r=this.state)?r.loading:void 0,ref:this.submit_button_ref||(this.submit_button_ref=React.createRef())},this.props.post_label||this.tt("community.post_form.post")),this.props.more_buttons))}}),R.package("Game")("Comments",{pure:!0,getDefaultProps:function(){return{autoload_count:1}},getInitialState:function(){return{posts:this.props.posts,pagination:this.props.pagination,autoload_count:this.props.autoload_count}},create_scroll_restore:function(t){var e,r,o;return(t=$(t).find(".post_grid")).length?(r=t.offsetParent(),o=window.document.documentElement.scrollTop,e=t.position().top-o,function(){return window.document.documentElement.scrollTop=t.position().top-e}):function(){}},load_page:function(t){var e,r;if(null==t&&(t="next_page"),null!=(e=this.state.pagination)?e[t]:void 0)return this.setState({loading:!0}),$.getJSON(this.props.topic.url,this.state.pagination[t]).done((r=this,function(e){var o,i,s,n,a,l,u,p,c;return e.posts?((s=Object.assign({},r.props.pagination))[t]=null!=(l=e.pagination)?l[t]:void 0,a=(function(){switch(t){case"prev_page":return e.posts.concat(this.state.posts);case"next_page":return this.state.posts.concat(e.posts)}}).call(r),c="prev_page"===t&&(i=null!=(n=null!=(u=r.post_list_ref)?u.current:void 0)&&null!=(p=n.first_post_ref)?p.current:void 0)?(o=ReactDOM.findDOMNode(i),r.create_scroll_restore(o)):void 0,r.setState({loading:!1,posts:a,pagination:s},c)):r.setState({loading:!1,pagination:null})}))},render:function(){var e,o,i,s,a,l,u,p,c,h;return this.enclose({},d({},this.tt("game.comments.comments_header")),t.PostForm({key:"post-"+((null!=(o=this.state)?o.post_counter:void 0)||0),submit_url:this.props.post_form.submit_url,post_label:this.tt("game.comments.post_comment"),recaptcha_sitekey:this.props.recaptcha_sitekey,remember_key:this.props.remember_key||"topic:"+this.props.topic.id,redactor_opts:this.props.post_form.redactor_opts,body_format:this.props.body_format,on_create_post:this.on_create_post||(this.on_create_post=(l=this,function(t){return l.setState(function(e){return t.just_added=!0,{post_counter:(e.post_counter||0)+1,posts:[t].concat(e.posts||[])}})}))}),this.state.pagination&&this.state.pagination.prev_page?L({className:"pagination_buttons"},r({href:this.props.topic.url+"?"+$.param(this.state.pagination.prev_page),className:"load_posts_before",disabled:null!=(i=this.state)?i.loading:void 0,onClick:this.load_prev_page||(this.load_prev_page=(u=this,function(t){return t.preventDefault(),u.load_page("prev_page")}))},"Show previous posts ↑")):void 0,t.PostList({ref:this.post_list_ref||(this.post_list_ref=React.createRef()),posts:this.state.posts,urls:this.props.urls,current_user:this.props.current_user||I.current_user,reply_form_params:this.reply_form_params||(this.reply_form_params={recaptcha_sitekey:this.props.recaptcha_sitekey,redactor_opts:this.props.post_form.redactor_opts,body_format:this.props.body_format}),edit_post:this.edit_post||(this.edit_post=(p=this,function(t,e){return p.setState(function(r){var o;return{posts:function(){var i,s,n,a;for(i=0,n=r.posts,a=[],s=n.length;i<s;i++)if((o=n[i])===t){if("remove"===e)continue;a.push($.extend({},t,e))}else a.push(o);return a}()}})}))}),this.state.pagination&&this.state.pagination.next_page?(e=n({className:"pagination_buttons"},r({href:this.props.topic.url+"?"+$.param(this.state.pagination.next_page),className:classNames("load_posts_after",{loading:null!=(s=this.state)?s.loading:void 0}),onClick:this.load_next_page||(this.load_next_page=(c=this,function(t){var e;if(t.preventDefault(),null==(e=c.state)||!e.loading)return c.load_page("next_page")}))},(null!=(a=this.state)?a.loading:void 0)?"Loading...":"Load more")),this.state.autoload_count>0?t.LoadOnScroll({key:JSON.stringify(this.state.pagination),on_seen:(h=this,function(){return h.setState(function(t){return{autoload_count:t.autoload_count-1}}),h.load_page("next_page")})},e):e):void 0)}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,(t=R.package("Community"))("TopicVoter",{propTypes:{post_id:(E=PropTypes).number.isRequired,vote:E.string,vote_url:E.string.isRequired,score:E.number.isRequired,adjustment:E.number,dir:E.string},getInitialState:function(){return{vote:this.props.vote}},vote:function(t){var e,r,o,i,s;if(!I.current_user){window.location=this.login_url();return}return this.setState({loading:!0}),o=_.template(this.props.vote_url)({post_id:this.props.post_id}),r=!1,e=t===this.state.vote?(r=!0,{action:"remove"}):{direction:t},$.ajax({url:o,type:"POST",dataType:"json",data:I.with_csrf(e),xhrFields:{withCredentials:!0}}).done((i=this,function(e){if(i.setState({loading:!1}),e.success)return i.setState({vote:!r&&t,adjustment:e.score_adjustment}),$(ReactDOM.findDOMNode(i)).find("button").trigger("i:refresh_tooltip")})).fail((s=this,function(t){return s.setState({loading:!1,has_error:!0})}))},login_url:function(){return"/login?"+$.param({return_to:window.location.toString(),intent:"community"})},render:function(){var t,e,r,o,s;return e=this.props.score,this.state.vote&&(e+=null!=(t=this.state.adjustment)?t:this.props.adjustment),r="vote_btn button small",n({},i({type:"button","aria-label":"up"===this.state.vote?"Remove up vote":"Vote up",className:classNames(r,"vote_up_btn icon-caret-up",{outline:"up"!==this.state.vote,disabled:this.state.loading}),disabled:this.state.loading,onClick:(o=this,function(){return o.vote("up")})}),n({className:"vote_score"},e),"up"!==this.props.dir?i({type:"button","aria-label":"down"===this.state.vote?"Remove down vote":"Vote down",className:classNames(r,"vote_down_btn icon-caret-down",{outline:"down"!==this.state.vote,disabled:this.state.loading}),disabled:this.state.loading,onClick:(s=this,function(){return s.vote("down")})}):void 0)}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Admin"),E=PropTypes,t("RemoteDataList",{componentDidMount:function(){var t;return $.ajax({url:this.props.url,dataType:"json",xhrFields:{withCredentials:!0}}).done((t=this,function(e){return t.setState(e)}))},render:function(){var t,e;return(null!=(t=this.state)?t.tag_slugs:void 0)?React.createElement("datalist",{id:this.props.id},this.state.tag_slugs.map(function(t){return S({key:t,value:t})})):null}}),t("TagEditor",{getInitialState:function(){return{closed:!1,featured_tags:this.props.featured_tags,tags:this.props.tags}},update_from_res:function(t){if(t.errors){this.setState({errors:t.errors});return}return t.featured_tags||(t.featured_tags=[]),t.tags||(t.tags=[]),this.setState(t)},feature_tag:function(t,e){return null==e&&(e="add"),this.setState({errors:null}),$.ajax({url:this.props.submit_url,type:"post",dataType:"json",xhrFields:{withCredentials:!0},data:I.with_csrf({action:e,tag_slug:t})}).done(this.update_from_res)},render_queue:function(){var t,e;return n({className:classNames("queue_status",t=(null!=(e=this.props.queue_rating)?e.rating:void 0)||"unrated",{unrated:!this.props.queue_rating})},r({href:this.props.queue_url},t))},render_suggested_tweet:function(){if(this.props.suggested_tweet)return p({},React.createElement("hr",{}),React.createElement("details",{},React.createElement("summary",{},F({},"Tweet builder")),P({className:"tweet_preview",defaultValue:this.props.suggested_tweet}),z({},"Len: "+this.props.suggested_tweet.length),this.props.cover_url?n({},r({href:this.props.cover_url},"Original cover")):void 0))},has_featured_tag:function(t){var e,r,o,i;if(!this.state.featured_tags)return!1;for(e=0,r=(o=this.state.featured_tags).length;e<r;e++)if((i=o[e]).tag_slug===t)return!0;return!1},render:function(){var e,o,s,l,c,d,h,m,f;return this.state.closed?null:this.enclose({},this.state.errors?n({className:"form_errors"},this.state.errors.join(", ")):void 0,this.render_queue(),n({className:"panel_inside"},F({},"User tags"),(null!=(e=this.state.tags)?e.length:void 0)?(s={},this.state.tags.map((l=this,function(t){if(!s[t.tag_slug])return s[t.tag_slug]=!0,n({className:"tag_row",key:t.tag_slug},n({},r({href:t.url},t.featured?F({},t.tag_slug):t.tag_slug),l.has_featured_tag(t.tag_slug)?" ☑":p({}," (",r({href:"#",className:"feature_tag_btn",onClick:function(e){return e.preventDefault(),l.feature_tag(t.tag_slug)}},"add"),")")))}))):n({className:"tag_row"},a({},"None")),React.createElement("hr",{}),F({},"Featured tags"),u({method:"POST",action:this.props.submit_url,className:"new_tag_form",onSubmit:(c=this,function(t){return t.preventDefault(),I.remote_submit($(t.target)).done(c.update_from_res).done(function(){var t;return null!=(t=c.tag_input_ref.current)?t.value="":void 0})})},R.CSRF({}),y({type:"hidden",name:"action",value:"add"}),y({ref:this.tag_input_ref||(this.tag_input_ref=React.createRef()),onMouseEnter:(d=this,function(){if(!d.state.focused)return d.setState({focused:!0})}),onFocus:(h=this,function(){if(!h.state.focused)return h.setState({focused:!0})}),type:"text",name:"tag_slug",list:"tag-options"}),this.state.focused?t.RemoteDataList({url:this.props.submit_url,id:"tag-options"}):void 0,i({},"Add")),null!=(o=this.state.featured_tags)?o.map((m=this,function(t){return n({className:"tag_row",key:t.tag_slug},n({},r({href:t.url},t.tag_slug)," (",r({href:"#",className:"feature_tag_btn",onClick:function(e){return e.preventDefault(),m.feature_tag(t.tag_slug,"delete")}},"remove"),")"))})):void 0,this.render_suggested_tweet()),i({className:"close_btn",onClick:(f=this,function(){return f.setState({closed:!0})})},"\xd7"))}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G,V,q,A;l=(e=ReactDOMFactories).div,P=e.span,r=e.a,i=e.br,j=e.p,S=e.ol,A=e.ul,C=e.li,E=e.strong,u=e.em,w=e.img,c=e.form,x=e.label,k=e.input,V=e.textarea,s=e.button,y=e.iframe,h=e.h1,m=e.h2,f=e.h3,g=e.h4,v=e.h5,b=e.h6,D=e.pre,n=e.code,F=e.select,T=e.option,z=e.section,L=e.optgroup,p=e.fieldset,N=e.legend,(d=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Game"),q=PropTypes,a=ReactDOMFactories.details,G=ReactDOMFactories.summary,o=ReactDOMFactories.abbr,t("QuarantineLightbox",{pure:!0,render_timestamp:function(t){return o({title:t,className:"datetime"},P({className:"icon icon-stopwatch","aria-hidden":"true"})," ",I.format_timestamp(t))},render:function(){return R.Lightbox({className:this.enclosing_class_name()},m({},"WARNING: This Page Has Been Quarantined"),j({},E({},"Our system has flagged this page for additional review due to potential suspicious behavior from the page owner. ")),j({},"If someone has asked you to download from this page and you don't fully trust them or their behavior isn't what you recognize then we don't recommend downloading this file until our team has reviewed the page. "),j({},r({href:"https://itch.io/t/1659440/psa-beware-discord-scammers",className:"forward_link",target:"_blank"},'Learn more about the recent "Try my game" Discord scam')),z({},f({},"Page and Account Details"),A({className:"account_summary"},C({},"Page created ",this.render_timestamp(this.props.game_created_at)),C({},"Account created ",this.render_timestamp(this.props.user_created_at)),this.props.user_email_verified?void 0:C({},"Account's email is not verified"),this.props.user_email_invalid?C({},P({className:"icon icon-warning"})," ","Account may have fake email address"):void 0,this.props.user_recent_countries?C({},"Regions this account has connected from: ",E({},new Intl.ListFormat("en").format(this.props.user_recent_countries))):void 0)),a({},G({},"I understand the risks, let me download anyway..."),l({className:"download_row"},s({type:"button",className:"button",onClick:this.force_download},"Download ",this.props.upload.name?n({},this.props.upload.name):void 0,this.props.upload.size?P({className:"upload_size"}," ("+I.format_bytes(this.props.upload.size)+")"):void 0)," Uploaded ",this.render_timestamp(this.props.upload.created_at))),j({className:"buttons"},s({type:"button",className:"button",onClick:this.report_page},"Report this page")," ",s({type:"button",className:"button outline close_btn"},"Close")))},report_page:function(){return I.Lightbox.open_remote_react(this.props.report_url,function(t){return R.Game.ReportLightbox(t)})},force_download:function(){return this.props.on_force_download?this.props.on_force_download():(I.bypass_quarantine=!0,I.Lightbox.close())}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Game"),E=PropTypes,t("ReportLightbox",{pure:!0,render:function(){var t;return R.Lightbox({className:this.enclosing_class_name()},(null!=(t=this.state)?t.submitted:void 0)?this.render_after_submit():this.render_report_form())},get_report_options:function(){var t;return t=[["broken","Broken","Doesn't run, download, or crashes"],["offensive","Offensive material"],["doesnt_own","Uploader not authorized to distribute"],["miscategorized","Miscategorized","Shows up on wrong part of itch.io, incorrect tags, incorrect platforms, etc."],["spam","Spam"],["other",this.tt("game.report_form.reason_other")]],this.props.jam&&t.unshift(["invalid_jam_submission","Invalid jam submission","Empty or incomplete page, breaks rules, etc."]),t},render_report_form:function(){var t,e,o,s,a,l,c;return p({},d({},this.tt("game.report_form.title",{page_title:this.props.page_title})),u({className:"form",method:"post",action:this.props.submit_url,onSubmit:(l=this,function(t){return t.preventDefault(),l.setState({errors:null,loading:!0}),I.remote_submit($(t.target)).done(function(t){if(t.errors){l.setState({loading:!1,errors:t.errors});return}return l.setState({submitted:!0,report_id:t.report_id})})})},R.CSRF({}),this.props.support_email||this.props.support_link?L({className:"support_notice"},this.tt("game.report_form.support_from_creator")," ",this.props.support_link?r({rel:"nofollow",target:"blank",className:"forward_link",href:this.props.support_link},this.tt("game.report_form.support_page_link")):r({rel:"nofollow",target:"blank",className:"forward_link",href:"mailto:"+this.props.support_email},this.tt("game.report_form.email_creator_link"))):void 0,(null!=(t=this.state)?t.errors:void 0)?R.Forms.FormErrors({errors:this.state.errors,animated:!0,scroll_into_view:!0}):void 0,L({},this.tt("game.report_form.form_description")),this.props.jam?L({},"This report will be made available to hosts of ",r({href:this.props.jam.url},this.props.jam.name),"."):void 0,n({className:"input_row"},n({className:"label"},this.tt("game.report_form.reason_label")),R.Forms.RadioButtons({name:"report[reason]",value:(null!=(e=this.state)?e.reason:void 0)||"",onChange:(c=this,function(t){return c.setState({reason:t.target.value})}),options:this.get_report_options()})),(null!=(o=this.state)?o.reason:void 0)==="doesnt_own"?n({className:"input_row"},F({},"Are you the copyright owner and need to file a DMCA notice?")," ",r({target:"_blank",href:this.props.itchio_support_url,className:"forward_link"},"Contact our support team so we can step you through the process")):void 0,n({className:"input_row"},w({},n({className:"label"},this.tt("game.report_form.description_label"),z({className:"sub"}," — ",this.description_description())),P({maxLength:"2048",name:"report[description]",required:this.description_required(),placeholder:this.description_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}))),R.Forms.TextInputRow({title:"Your email",sub:"If your report needs a reply we'll use it to communicate with you",name:"report[email]",defaultValue:this.props.current_user_email,required:this.email_required(),placeholder:this.email_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}),n({callback:"buttons"},i({disabled:null!=(s=this.state)?s.loading:void 0,className:classNames("button",{disabled:null!=(a=this.state)?a.loading:void 0})},this.tt("game.report_form.submit_report_button")))))},render_after_submit:function(){var t;return n({className:"report_submitted"},d({},this.tt("game.report_form.report_received_header")),L({},"You report will be reviewed shortly, and action will be taken if necessary. If you have any additional requests then you can ",r({href:this.props.itchio_support_url,target:"_blank"},"contact our support team"),"."),this.state.report_id?L({},"If you need to talk to itch.io staff about your report please use the following reference code: ",s({},F({},"R-"+this.state.report_id)),"."):void 0,L({},i({type:"button",className:"textlike",onClick:function(t){return I.Lightbox.close()}},this.tt("misc.lightboxes.close"))))},description_description:function(){var t;switch(null!=(t=this.state)?t.reason:void 0){case"broken":return"Please explain what is broken. Include how you tried to run the project, what operating system or browser you're using, and any error messages you saw. We will share your error with the creator to help them fix the issue.";case"invalid_jam_submission":return"Please explain why this submission should be disqualified or removed";case"miscategorized":return"Please explain how this project should be categorized.";default:return"Please provide a summary of your report"}},description_required:function(){var t,e;return"broken"===(t=null!=(e=this.state)?e.reason:void 0)||"miscategorized"===t||"other"===t||"invalid_jam_submission"===t},email_required:function(){var t,e;return"broken"===(t=null!=(e=this.state)?e.reason:void 0)||"doesnt_own"===t}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,(t=R.package("Library"))("RateGameLightbox",{propTypes:{game:(E=PropTypes).object.isRequired,follow_button:E.object,game_rating:E.object},is_closable:function(){var t,e;return(null!=(t=this.props)&&null!=(e=t.lightbox_props)?e.close:void 0)!==!1},submit_rating:function(t){var e;return t.preventDefault(),this.setState({loading:!0}),I.remote_submit($(t.target)).done((e=this,function(t){var r,o,i;if(t.errors){e.setState({loading:!1,errors:t.errors});return}return null!=(o=e.blurb_input_ref.current)&&o.clear_memory(),e.setState({submitted:!0,loading:!1,saved_score:null!=(i=t.game_rating)?i.score:void 0}),"function"==typeof(r=e.props).on_save_rating?r.on_save_rating(t):void 0}))},delete_rating:function(){var t;if(this.props.game_rating)return this.setState({loading:!0}),$.ajax({type:"POST",dataType:"json",url:this.props.rate_url,xhrFields:{withCredentials:!0},data:I.with_csrf({remove_game_rating:"1"})}).done((t=this,function(e){var r,o;if(t.setState({loading:!1}),e.errors){t.setState({errors:e.errors});return}return null!=(o=t.blurb_input_ref.current)&&o.clear_memory(),t.setState({submitted:!0,deleted:!0,game_rating:!1}),"function"==typeof(r=t.props).on_delete_rating?r.on_delete_rating(e):void 0}))},render_rating_form:function(){var t,e,o,s,a,l;return p({},d({},this.tt("library.rate_game.rate_header",{project_title:z({className:"object_title"},this.props.game.title)})),u({className:"form",action:this.props.rate_url,onSubmit:this.submit_rating},R.CSRF({}),(null!=(o=this.state)?o.errors:void 0)?R.Forms.FormErrors({animated:!0,errors:this.state.errors}):void 0,this.props.game_rating?(e=this.props.game_rating.created_at,L({},this.tt("library.rate_game.you_rated_this_project_ago",{time_ago:z({className:"date_format",title:e},I.format_timestamp(e))}))):L({},this.tt("library.rate_game.choose_stars")),n({className:"star_wrapper"},R.Forms.StarPicker({className:"star_picker",name:"game_rating",defaultValue:null!=(s=this.props.game_rating)?s.score:void 0})),n({className:"input_row"},n({className:"label"},"Your review",n({className:"sub"},"Share what you liked or disliked about this project. Our ",r({target:"_blank",href:"https://itch.io/docs/general/community-rules"},"community rules")," apply here. Reviews are shared with developers and your followers.")),R.Redactor({defaultValue:(t=null!=(a=this.props.game_rating)?a.blurb:void 0)?t._unsafe||t._safe:void 0,ref:this.blurb_input_ref||(this.blurb_input_ref=React.createRef()),remember_key:"game_rating:"+this.props.game.id,name:"game_rating_blurb",placeholder:"Optional",redactor_opts:{plugins:["table","alignment","video"],buttons:["bold","italic","deleted","lists","link"]}})),n({className:"buttons"},i({className:"button"},this.props.game_rating?this.tt("misc.forms.save"):this.tt("misc.forms.submit")),this.props.game_rating?i({type:"button",className:"textlike delete_rating_btn",onClick:(l=this,function(t){if(t.preventDefault(),confirm("Are you sure you want to delete your rating & review"))return l.delete_rating()})},this.tt("library.rate_game.delete_button")):void 0)))},render_after_rating:function(){var t,e;return(t=this.is_closable()?L({},i({type:"button",onClick:function(t){return t.preventDefault(),I.Lightbox.close()},className:"textlike"},this.tt("misc.lightboxes.close"))):void 0,this.state.deleted)?p({},d({},this.tt("library.rate_game.rating_removed_header")),L({},this.tt("library.rate_game.rating_deleted_summary")),t):p({},d({},this.tt("library.rate_game.rating_saved_header")),this.props.follow_button&&(this.state.saved_score||0)>=3?n({className:"suggested_follow"},L({},this.tt("library.rate_game.follow_creator",{project_title:r({href:this.props.game.url,target:"_blank"},this.props.game.title)})),L({},R.FollowButton(this.props.follow_button))):L({},"Your rating has been saved."),t)},render:function(){var t;return R.Lightbox(Object.assign({className:this.enclosing_class_name()},this.props.lightbox_props),(null!=(t=this.state)?t.submitted:void 0)?this.render_after_rating():this.render_rating_form())}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,E=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Ads"),R("ShareButtons",{pure:!0,render:function(){return this.enclose({className:"simple_social_buttons_widget"},this.props.twitter?r({href:this.props.twitter.url,target:"_blank",rel:"noopener nofollow",className:"twitter_link",title:"Share on Twitter..."},z({className:"icon icon-twitter"})):void 0,this.props.facebook?r({href:this.props.facebook.url,target:"_blank",rel:"noopener nofollow",className:"facebook_link",title:"Share on Facebook..."},z({className:"icon icon-facebook"})):void 0)}}),t("AfterDownload",{pure:!0,componentDidMount:function(){var t,e;return t=ReactDOM.findDOMNode(this),(e=document.createElement("script")).async=!0,e.src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",t.appendChild(e),(window.adsbygoogle||(window.adsbygoogle=[])).push({})},render:function(){return n({},React.createElement("ins",{className:"adsbygoogle",style:{display:"block"},"data-ad-client":"ca-pub-4267538250984114","data-ad-slot":"9114825859","data-ad-format":"auto","data-full-width-responsive":"true"}))}}),R("AfterDownloadLightbox",{componentDidMount:function(){var t,e;if(this.props.push_state)try{return e={title:document.title,url:window.location.toString()},"function"==typeof(t=window.history).replaceState&&t.replaceState({},this.props.push_state.title,this.props.push_state.url),this.previous_state=e}catch(r){}},componentWillUnmount:function(){var t;if(this.previous_state)return"function"==typeof(t=window.history).replaceState&&t.replaceState({},this.previous_state.title,this.previous_state.url),delete this.previous_state},render:function(){var t;return R.Lightbox({className:this.enclosing_class_name()},d({},this.tt("game.after_download.thanks_for_downloading_title")),L({},this.tt("game.after_download.thanks_project_author",{author:this.props.user.name,project:a({},this.props.game.title)}),this.props.has_more_games?p({}," ",this.tt("game.after_download.more_from_creator",{profile:r({href:this.props.user.url},this.props.user.name)})):void 0," ",this.tt("game.after_download.check_popup_blocker")),this.props.show_ad?R.Ads.AfterDownload({}):void 0,this.props.show_app_banner&&this.props.app_url?L({},this.tt("game.after_download.app_learn_more",{s:function(t){return F({},t)},a:(t=this,function(e){return r({href:t.props.app_url,className:"forward_link","data-action":"download_app","data-label":"app_notice"},e)})})):void 0,n({className:"share_row"},this.props.user.follow_button?R.FollowButton(this.props.user.follow_button):void 0,this.props.share_buttons?z({className:"share_links"},z({className:"icon icon-heart"})," ",I.i18n.locale_is_english()?"Share this "+this.props.game.noun+":":this.tt("game.after_download.share_this_project"),R.ShareButtons(this.props.share_buttons)):void 0),this.render_jam_games()||this.render_rec_games(),n({className:"bandwidth_row"},this.tt("game.after_download.powered_by",{s:function(t){return z({className:"powered"},t)},itchio_logo:b({height:25,src:this.props.logo_url})})))},render_jam_games:function(){if(this.props.jam_games&&this.props.jam_games.length)return j({className:"related_games"},h({},this.tt("game.after_download.check_out_more_from_jam_title",{jam_title:r({href:this.props.related_jam.url,target:"_blank"},this.props.related_jam.title)})),this.render_game_grid(this.props.jam_games,{show_rating:!1}),this.props.related_jam.entries_url?n({className:"browse_footer"},r({href:this.props.related_jam.entries_url,className:"button outline"},this.tt("game.after_download.view_all_from_jam"))):void 0)},render_rec_games:function(){if(this.props.rec_games&&this.props.rec_games.length)return j({className:"related_games"},h({},this.props.rec_games_title||this.tt("game.after_download.more_from_itchio_header")),this.render_game_grid(this.props.rec_games),n({className:"browse_footer"},r({href:this.props.browse_url,className:"button outline"},this.tt("game.after_download.see_everything"))))},render_game_grid:function(t,e){return R.Index.GameGrid({games:t,cell_width:200,fit_rows:3,enable_popups:!1,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,cell_props:$.extend({target:"_blank",show_rating:!0,show_cell_tools:!1},e)})}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G,V;a=(r=ReactDOMFactories).div,F=r.span,o=r.a,i=r.br,T=r.p,C=r.ol,V=r.ul,N=r.li,P=r.strong,l=r.em,y=r.img,p=r.form,k=r.label,w=r.input,E=r.textarea,s=r.button,b=r.iframe,d=r.h1,h=r.h2,m=r.h3,f=r.h4,g=r.h5,v=r.h6,j=r.pre,n=r.code,z=r.select,L=r.option,D=r.section,S=r.optgroup,u=r.fieldset,x=r.legend,(c=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Index"),e={},t("ConversionLink",{pure:!0,propTypes:{source:(G=PropTypes).number,object_type:G.number,object_id:G.number,href:G.string,target:G.string,class:G.any,impression:G.bool,on_click:G.func,on_impression:G.func},getInitialState:function(){return{seen:!1}},get_suffix:function(){return this.props.source+":"+this.props.object_type+":"+this.props.object_id},on_click:function(t){var e,r,o,i,s,n;if("click"===t.type){if(e=ReactDOM.findDOMNode(this),o=t.metaKey||t.ctrlKey||t.shiftKey||"_blank"===this.props.target,T=this.handle_click(),!o&&"resolved"!==T.state())return t.preventDefault(),i=new Date,r=(s=this,function(){if(r)return r=null,window.location=s.props.href}),setTimeout(function(){return"function"==typeof r?r():void 0},200),T.done(r)}},on_mouse_up:function(t){if(1===t.button)return this.handle_click()},handle_click:function(){var t,r,o;return this.props.object_type&&this.props.source&&this.props.object_id?this.state.clicked?this.state.clicked:e[r=I.ConversionTracker.types.click+":"+this.get_suffix()]?$.when():(e[r]=!0,I.ConversionTracker.click(this.get_suffix()),T=I.ConversionTracker.flush_now_beacon(),this.props.track_referrer&&(o=I.ReferrerTracker).push.apply(o,this.props.track_referrer),this.setState({clicked:T}),"function"==typeof(t=this.props).on_click&&t.on_click(),T):$.when()},componentDidMount:function(){var t,r;if(this.props.object_type&&this.props.source&&this.props.object_id&&!1!==this.props.impression&&!e[I.ConversionTracker.types.impression+":"+this.get_suffix()])return t=ReactDOM.findDOMNode(this),this.unbind_visibility=$(t).lazy_images({elements:[t],show_images:(r=this,function(){var t,o;return e[o=I.ConversionTracker.types.impression+":"+r.get_suffix()]||(I.ConversionTracker.push(o),e[o]=!0),r.setState({seen:!0}),"function"==typeof(t=r.props).on_impression&&t.on_impression(),"function"==typeof r.unbind_visibility&&r.unbind_visibility(),r.unbind_visibility=null})})},componentWillUnmount:function(){return"function"==typeof this.unbind_visibility?this.unbind_visibility():void 0},render:function(){var t;return o({href:this.props.href,className:this.props.class||this.props.className,onClick:this.on_click,onMouseUp:this.on_mouse_up,target:this.props.target,tabIndex:null!=(t=this.props.tabindex)?t:this.props.tabIndex,"aria-hidden":this.props["aria-hidden"]},this.props.children)}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G,V,q,A,O=[].slice;l=(o=ReactDOMFactories).div,P=o.span,i=o.a,s=o.br,j=o.p,S=o.ol,q=o.ul,C=o.li,E=o.strong,u=o.em,w=o.img,c=o.form,x=o.label,k=o.input,G=o.textarea,n=o.button,y=o.iframe,h=o.h1,m=o.h2,f=o.h3,g=o.h4,v=o.h5,b=o.h6,D=o.pre,a=o.code,F=o.select,T=o.option,z=o.section,L=o.optgroup,p=o.fieldset,N=o.legend,(d=React.createElement.bind(null,React.Fragment)).type=React.fragment,t=R.package("Index"),V=PropTypes,e={linux:"tux",osx:"apple",windows:"windows8",android:"android"},r={linux:"Linux",osx:"macOS",windows:"Windows",android:"Android"},t("PlatformList",{pure:!0,getDefaultProps:function(){return{prefix:"Available for"}},render:function(){var t,o,i,s,n;if(!(this.props.platforms&&this.props.platforms.length))return null;for(t=0,s=[],o=(n=this.props.platforms).length;t<o;t++)i=n[t],s.length>0&&s.push(" "),s.push(P({key:i,className:"icon icon-"+e[i],"aria-hidden":"true",title:this.props.prefix+" "+r[i]}));return s}}),t("StarRating",{propTypes:{average:V.number,count:V.number},pure:!0,render:function(){var t,e;return l({className:"game_rating",title:"Average: "+(t=this.props.average||0).toFixed(2)},P({className:"screenreader_only"},"Average rating "+t.toFixed(2)+" out of 5"),l({className:"star_value"},l({className:"star_fill",style:{width:(t/5*100).toFixed(5)+"%"}},function(){var t,r;for(r=[],e=t=1;t<=5;e=++t)r.push(P({key:e,className:"star icon-star","aria-hidden":"true"}));return r}()),l({className:"star_holes"},function(){var t,r;for(r=[],e=t=1;t<=5;e=++t)r.push(P({key:e,className:"star icon-star2","aria-hidden":"true"}));return r}()))," ",P({className:"rating_count"},"("+I.format_integer(this.props.count),P({className:"screenreader_only"}," total ratings"),")"))}}),t("GameCell",{pure:!0,getDefaultProps:function(){return{show_price:!0,show_short_text:!0,show_platforms:!0,show_rating:!0,show_cell_tools:!0}},getInitialState:function(){return{game:this.build_game()}},componentDidUpdate:function(t){if(t.build_game_object!==this.props.build_game_object||t.game!==this.props.game)return this.setState({game:this.build_game()})},update_focus:function(t){return this.setState({cell_tools_focused:t.currentTarget.contains(document.activeElement)})},build_game:function(){return this.props.build_game_object?this.props.build_game_object(this.props.game):this.props.game},add_to_collection:function(t){if(I.current_user)return t.preventDefault(),I.Lightbox.open_remote("/game/collections/"+this.state.game.id,I.CollectionLightbox)},mark_gif_loaded:function(){return this.setState({gif_loaded:!0})},track_grid_referrer:function(){if(this.props.grid_referrer)return I.ReferrerTracker.push("game",this.state.game.id,this.props.grid_referrer)},game_link:function(){var e,r,o;return(o=arguments[0],e=2<=arguments.length?O.call(arguments,1):[],this.props.conversion_source)?(r=$.extend({object_type:1,object_id:this.state.game.id,source:this.props.conversion_source,on_click:this.props.grid_referrer?this.track_grid_referrer:void 0},o),t.ConversionLink.apply(t,[r].concat(O.call(e)))):i.apply(null,[o].concat(O.call(e)))},render_user:function(t,e){return null==e&&(e=null),i({key:e,className:"user_link",href:t.url,target:this.props.target},t.name)},render:function(){var r,o,s,n,a,u,p,c,h,m,f,g,v,b,y,w,k,x;return v=(p=this.state.game).user,h=p.platforms?function(){var t,r,o,i;for(t=0,o=p.platforms,i=[],r=o.length;t<r;t++)e[c=o[t]]&&i.push(c);return i}():void 0,a=p.cover_color&&I.Color?(m=(f=I.Color.parse_color(p.cover_color))[0],"rgba("+m+", "+(u=f[1])+", "+(r=f[2])+", 0.5)"):void 0,this.enclose({"data-game_id":p.id,dir:"auto",className:classNames("game_cell",{focused:this.state.cell_tools_focused}),onMouseEnter:this.state.game.gif_cover?(b=this,function(){return b.setState({hovering:!0})}):void 0,onMouseLeave:this.state.game.gif_cover?(y=this,function(){return y.setState({hovering:!1})}):void 0},l({className:"bordered",style:a&&{backgroundColor:a}},this.game_link({href:p.url,target:this.props.target,className:"game_thumb","aria-hidden":"true",tabIndex:-1},"function"==typeof(o=this.props).render_thumb_extras?o.render_thumb_extras(p):void 0,p.cover?t.LazyImage({src:p.cover}):l({className:"missing_image"},"no image :("),p.gif_cover?l({className:"gif_label"},"GIF"):void 0,(null!=(g=this.state)?g.hovering:void 0)&&p.gif_cover?React.createElement(React.Fragment,{},this.state.gif_loaded?void 0:l({className:"gif_loading_overlay"}),t.LazyImage({className:"gif_cover",src:p.gif_cover,on_load:this.mark_gif_loaded})):void 0),this.props.show_price&&p.sale_rate?l({className:classNames("sale_flag",{reverse_sale:p.sale_rate<0})},l({className:"rate"},Math.abs(p.sale_rate)+"%"),l({className:"mini_label"},p.sale_rate<0?"more":"off")):void 0,(null!=h?h.length:void 0)?l({className:"p_data fading_data"},t.PlatformList({platforms:h})):void 0,this.props.show_cell_tools?l({className:"fading_data cell_tools",onFocus:this.update_focus,onBlur:this.update_focus},"function"==typeof(s=this.props).render_cell_extras?s.render_cell_extras(p):void 0,i({href:p.url+"/add-to-collection",title:this.t("add_to_collection.add_button"),className:"add_to_collection_btn",onClick:this.add_to_collection,role:"button",onKeyDown:(w=this,function(t){if(" "===t.key)return w.add_to_collection(t)})},P({className:"icon icon-playlist_add","aria-hidden":"true"}),P({className:"screenreader_only"},"Add to collection"))):void 0),l({className:"label"},(function(){if(this.props.show_price)switch(p.flag){case"free":return l({className:"meta_tag free_tag"},"Free");case"web":return l({className:"meta_tag free_tag"},"Web");case"demo":return l({className:"meta_tag demo_tag"},"Demo");default:if(p.price)return l({className:classNames("price_tag meta_tag")},p.price)}}).call(this),this.game_link({target:this.props.target,className:"title",title:p.title,href:p.url},p.title)),l({className:"user_row"},p.contributors?p.contributors.map((k=this,function(t,e){return e>0?d({key:"user-"+e},", ",k.render_user(t)):k.render_user(t,"user-"+e)})):this.render_user(v)),this.props.show_rating&&p.rating?t.StarRating(p.rating):void 0,p.tags&&p.tags.length?l({className:"sub cell_tags"},p.tags.map((x=this,function(t,e){return React.createElement(React.Fragment,{key:t.name},e>0?", ":void 0,i({href:t.url,target:x.props.target},"#"+t.name))}))):void 0,this.props.show_short_text&&p.short_text?l({className:"sub short_text"},p.short_text):void 0,"function"==typeof(n=this.props).render_cell_below?n.render_cell_below(p):void 0)}}),t("GameGrid",{calculate_cell_sizes:(A=this,function(){var t,e;return null!=(t=A.grid_sizer_ref)&&null!=(e=t.current)?e.calculate_cell_sizes():void 0}),componentDidMount:function(){var t;if(t=this.container(),this.props.enable_popups)return new I.GamePopups(t,{x_offset:10})},getDefaultProps:function(){return{cell_width:I.is_mobile()?300:250,enable_popups:!0,render_game:function(e){var r;return r={render_thumb_extras:this.props.render_thumb_extras,render_cell_extras:this.props.render_cell_extras,render_cell_below:this.props.render_cell_below,key:e.id,game:e,build_game_object:this.props.build_game_object,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer},this.props.cell_props&&(r=$.extend(r,this.props.cell_props)),t.GameCell(r)}}},render:function(){var e,r;return e={ref:this.grid_sizer_ref||(this.grid_sizer_ref=React.createRef()),cell_margin:10,expected_width:this.props.cell_width,fit_rows:this.props.fit_rows,children:null!=(r=this.props.games)?r.map(this.props.render_game.bind(this)):void 0},this.props.grid_sizer_props&&(e=$.extend(e,this.props.grid_sizer_props)),this.enclose({},t.GridSizer(e))}}),t("NewFromFollowers",{getInitialState:function(){return{games:this.props.games}},componentDidUpdate:function(t,e){var r,o;if((null!=(r=e.games)?r.length:void 0)!==(null!=(o=this.state.games)?o.length:void 0))return $(window).trigger("i:reshape")},on_dismiss_games:function(t){var e,r,o,i,s,n,a,l;if((null==(o=this.state)||!o.loading)&&(r=null!=(i=this.game_grid_ref)&&null!=(s=i.current)&&null!=(n=s.grid_sizer_ref)?n.current:void 0)&&(a=this.state.games.slice(0,r.get_num_visible())).length)return this.setState({loading:!0}),$.post(this.props.dismiss_url,I.with_csrf({object_type:"game",object_id:(function(){var t,r,o;for(t=0,o=[],r=a.length;t<r;t++)e=a[t],o.push(e.id);return o})().join(",")})).done((l=this,function(t){return $.get(l.props.more_results_url).done(function(t){return l.setState({games:_.toArray(t.games),loading:!1})})}))},render_cell_extras:function(t){var e;return n({type:"button",className:"dismiss_btn",onClick:(e=this,function(){var r,o;return o=(function(){var e,o,i,s;for(e=0,i=this.state.games,s=[],o=i.length;e<o;e++)(r=i[e])!==t&&s.push(r);return s}).call(e),e.setState({games:o}),$.post(e.props.dismiss_url,I.with_csrf({object_type:"game",object_id:t.id})).done(function(t){return e.fetch_more_if_necessary()})})},"Dismiss")},fetch_more_if_necessary:function(){var t,e,r,o,i;if(!this.state.loading&&!this.state.exhausted&&(t=null!=(e=this.game_grid_ref)&&null!=(r=e.current)&&null!=(o=r.grid_sizer_ref)?o.current:void 0)&&t.get_max_num_visible()>t.get_num_visible())return this.setState({loading:!0}),$.get(this.props.more_results_url).done((i=this,function(e){return e=_.toArray(null!=e?e.games:void 0),i.setState({exhausted:e.length<t.get_max_num_visible(),games:e,loading:!1})}))},render_dismiss_button:function(){var t;if((t=this.state.games).length)return n({className:"button outline",type:"button",onClick:this.on_dismiss_games},this.state.games.length>1?"Dismiss these":"Dismiss")},render:function(){var e;return this.state.games.length?this.enclose({component:"section",className:classNames("game_section",{loading:null!=(e=this.state)?e.loading:void 0})},l({className:"header_split"},l({},l({className:"section_header"},m({},"New From Those You Follow")),j({className:"section_description"},"Projects from those you follow that you haven't seen yet.")),this.render_dismiss_button()),t.GameGrid({ref:this.game_grid_ref||(this.game_grid_ref=React.createRef()),games:this.state.games,fit_rows:this.props.fit_rows,conversion_source:this.props.conversion_source,grid_referrer:this.props.grid_referrer,render_cell_extras:this.render_cell_extras})):null}})})}).call(this),(function(){I.libs.react.done(function(){var t,e,r,o,i,s,n,a,l,u,p,c,d,h,m,f,g,v,b,y,w,k,x,N,C,S,L,T,j,D,z,F,P,E,G;n=(e=ReactDOMFactories).div,z=e.span,r=e.a,o=e.br,L=e.p,N=e.ol,G=e.ul,x=e.li,F=e.strong,a=e.em,b=e.img,u=e.form,w=e.label,y=e.input,P=e.textarea,i=e.button,v=e.iframe,c=e.h1,d=e.h2,h=e.h3,m=e.h4,f=e.h5,g=e.h6,T=e.pre,s=e.code,D=e.select,S=e.option,j=e.section,C=e.optgroup,l=e.fieldset,k=e.legend,(p=React.createElement.bind(null,React.Fragment)).type=React.fragment,(t=R.package("Index"))("GridSizer",{propTypes:{children:(E=PropTypes).array},getInitialState:function(){return{}},getDefaultProps:function(){return{cell_margin:20,min_width:0,expected_width:315,min_columns:1,crop_on_resize:!0}},componentDidMount:function(){var t,e;return _.defer((t=this,function(){return t.calculate_cell_sizes()})),this.resize_callback=_.debounce((e=this,function(){return e.calculate_cell_sizes()}),250),$(window).on("resize",this.resize_callback)},componentWillUnmount:function(){return this.unmounted=!0,$(window).off("resize",this.resize_callback)},componentDidUpdate:function(t){if(t.children!==this.props.children){var e;return _.defer((e=this,function(){return e.calculate_cell_sizes()}))}},calculate_cell_sizes:function(t){var e,r,o,i,s,n,a;if(null==t&&(t=!1),!this.unmounted){if(r=this.get_width(),this.state.container_width!==r&&(n=this.props.expected_width+this.props.cell_margin,(s=Math.ceil(i=(e=r+this.props.cell_margin)/n))<this.props.min_columns&&(s=this.props.min_columns),(o=Math.floor(o=e/s-this.props.cell_margin))<this.props.min_width&&s>1&&(s-=1,o=Math.floor(o=e/s-this.props.cell_margin)),this.setState({container_width:r,cell_width:o,cells_per_row:s},this.props.on_reshape),!1===t))return _.defer((a=this,function(){return a.calculate_cell_sizes(!0)}))}},get_width:function(){var t,e,r,o,i;return o=(e=null!=(i=(t=this.container())[0])?i.getBoundingClientRect().width:void 0)-Math.floor(e),r=Math.floor(t.width()),o>0&&(r-=1),r},get_max_num_visible:function(){if(this.props.fit_rows&&this.state.cells_per_row)return this.state.cells_per_row*this.props.fit_rows},get_num_visible:function(){var t;return(t=this.props.children.length,this.props.fit_rows&&this.state.cells_per_row)?Math.min(t,this.state.cells_per_row*this.props.fit_rows):t},get_visible_children:function(){var t;return t=this.props.children,this.props.fit_rows&&this.state.cells_per_row&&(t=t.slice(0,this.state.cells_per_row*this.props.fit_rows)),t},render:function(){var t,e,r,o,i,s;return t=this.get_visible_children(),i={display:"grid",alignItems:"start",gap:this.props.cell_margin+"px"},e=this.props.crop_on_resize?{overflowX:"hidden"}:void 0,this.props.crop_on_resize&&this.state.container_width&&(i.width=this.state.container_width+"px"),s=this.state.cell_width&&this.state.cells_per_row?i.gridTemplateColumns="repeat("+this.state.cells_per_row+", "+this.state.cell_width+"px)":(o=window.innerWidth<400?5/9:7/9,r=Math.floor(this.props.expected_width*o),i.gridTemplateColumns="repeat(auto-fill, minmax("+r+"px, 1fr))"),this.enclose({component:this.props.component,style:e},React.createElement(this.props.sizer_component||"div",{className:"grid_sizer_children",style:i},t))}})})}).call(this);